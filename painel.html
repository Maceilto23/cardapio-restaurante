<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel do Card√°pio GitHub</title>
<style>
body { font-family: Arial; margin: 20px; background: #f9f9f9; }
h1,h2 { color: #333; }
label { display: block; margin-top: 10px; font-weight: bold; }
input[type=text],input[type=number] { width:300px; padding:5px; margin-top:5px; }
button { padding:10px 20px; margin-top:20px; background:#28a745;color:white;border:none;cursor:pointer; }
button:hover { background:#218838; }
.day-section,.section { border:1px solid #ccc; padding:10px; margin-top:15px; border-radius:5px; background:#fff; }
.list-item { display:flex; gap:10px; margin-top:5px; }
.list-item input { flex:1; }
.remove-btn { background:red;color:white;border:none;cursor:pointer;padding:3px 8px; }
#status { margin-bottom:15px; }
</style>
</head>
<body>

<h1>Painel do Card√°pio GitHub</h1>
<div id="status">üîÑ Carregando...</div>

<div id="painel" style="display:none;">
  <div class="section">
    <h2>Hor√°rio de Funcionamento</h2>
    <label>Abertura: <input type="text" id="abertura"></label>
    <label>Fechamento: <input type="text" id="fechamento"></label>
  </div>

  <div class="section">
    <h2>Valores das Marmitas</h2>
    <div id="valoresMarmita"></div>
    <button onclick="addValorMarmita()">Adicionar Op√ß√£o</button>
  </div>

  <div class="section">
    <h2>Card√°pio Di√°rio</h2>
    <div id="cardapioDias"></div>
  </div>

  <div class="section">
    <h2>Refrigerantes</h2>
    <div id="refrigerantes"></div>
    <button onclick="addRefrigerante('Lata')">Adicionar Lata</button>
    <button onclick="addRefrigerante('2 Litros')">Adicionar 2 Litros</button>
  </div>

  <div class="section">
    <h2>Locais de Entrega</h2>
    <div id="locaisEntrega"></div>
    <button onclick="addLocal()">Adicionar Local</button>
  </div>

  <div class="section">
    <h2>Formas de Pagamento</h2>
    <div id="formasPagamento"></div>
    <button onclick="addForma()">Adicionar Forma</button>
  </div>

  <button onclick="salvar()">üíæ Salvar Altera√ß√µes</button>
</div>

<script>
// ===== CONFIGURA√á√ÉO =====
const USER = 'Maceilto23';
const REPO = 'cardapio-restaurante';
const FILE_PATH = 'cardapio.json';
const TOKEN = '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';
let SHA; // SHA do arquivo atual

// ===== FUN√á√ïES DE CAMPOS =====
function addValorMarmita(nome='', preco=''){
  const div=document.createElement('div'); div.className='list-item';
  div.innerHTML=`<input type="text" placeholder="Nome da op√ß√£o" value="${nome}">
                 <input type="number" placeholder="Pre√ßo" value="${preco}">
                 <button class="remove-btn" onclick="this.parentNode.remove()">X</button>`;
  document.getElementById('valoresMarmita').appendChild(div);
}

function addDiaCardapio(dia,dados){
  const div=document.createElement('div'); div.className='day-section';
  div.innerHTML=`<h3>${dia}</h3>
                 <strong>Carnes:</strong><div class="carnes"></div><button onclick="addItem(this.parentNode.querySelector('.carnes'))">Adicionar Carne</button>
                 <strong>Acompanhamentos:</strong><div class="acompanhamentos"></div><button onclick="addItem(this.parentNode.querySelector('.acompanhamentos'))">Adicionar Acompanhamento</button>`;
  document.getElementById('cardapioDias').appendChild(div);
  dados.carnes.forEach(c=>addItem(div.querySelector('.carnes'),c));
  dados.acompanhamentos.forEach(a=>addItem(div.querySelector('.acompanhamentos'),a));
}

function addItem(container,value=''){
  const div=document.createElement('div'); div.className='list-item';
  div.innerHTML=`<input type="text" value="${value}"><button class="remove-btn" onclick="this.parentNode.remove()">X</button>`;
  container.appendChild(div);
}

function addRefrigerante(tipo,nome='',preco=''){
  const container=document.createElement('div'); container.className='list-item'; container.dataset.tipo=tipo;
  container.innerHTML=`<strong>${tipo}:</strong>
                       <input type="text" placeholder="Nome" value="${nome}">
                       <input type="number" placeholder="Pre√ßo" value="${preco}">
                       <button class="remove-btn" onclick="this.parentNode.remove()">X</button>`;
  document.getElementById('refrigerantes').appendChild(container);
}

function addLocal(nome='',taxa=''){
  const div=document.createElement('div'); div.className='list-item';
  div.innerHTML=`<input type="text" placeholder="Local" value="${nome}">
                 <input type="number" placeholder="Taxa" value="${taxa}">
                 <button class="remove-btn" onclick="this.parentNode.remove()">X</button>`;
  document.getElementById('locaisEntrega').appendChild(div);
}

function addForma(valor=''){
  const div=document.createElement('div'); div.className='list-item';
  div.innerHTML=`<input type="text" placeholder="Forma de pagamento" value="${valor}">
                 <button class="remove-btn" onclick="this.parentNode.remove()">X</button>`;
  document.getElementById('formasPagamento').appendChild(div);
}

// ===== CARREGAR CARD√ÅPIO DO GITHUB =====
async function carregar(){
  try {
    const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE_PATH}`);
    if(!res.ok) throw new Error('Erro ao carregar arquivo do GitHub');
    const data = await res.json();
    SHA = data.sha;
    const cardapio = JSON.parse(atob(data.content));

    document.getElementById('abertura').value = cardapio.horarioFuncionamento?.abertura || '';
    document.getElementById('fechamento').value = cardapio.horarioFuncionamento?.fechamento || '';

    const valoresDiv=document.getElementById('valoresMarmita'); valoresDiv.innerHTML='';
    for(let key in cardapio.valoresMarmita) addValorMarmita(key, cardapio.valoresMarmita[key]);

    const diasDiv=document.getElementById('cardapioDias'); diasDiv.innerHTML='';
    for(let dia in cardapio.cardapio) addDiaCardapio(dia, cardapio.cardapio[dia]);

    const refDiv=document.getElementById('refrigerantes'); refDiv.innerHTML='';
    for(let tipo in cardapio.refrigerantes) cardapio.refrigerantes[tipo].forEach(r=>addRefrigerante(tipo,r.nome,r.preco));

    const locaisDiv=document.getElementById('locaisEntrega'); locaisDiv.innerHTML='';
    cardapio.locaisEntrega?.forEach(l=>addLocal(l.nome,l.taxa));

    const formasDiv=document.getElementById('formasPagamento'); formasDiv.innerHTML='';
    cardapio.formasPagamento?.forEach(f=>addForma(f));

    document.getElementById('painel').style.display='block';
    document.getElementById('status').textContent='‚úÖ Card√°pio carregado';
  } catch(e){
    document.getElementById('status').textContent='‚ùå '+e.message;
    console.error(e);
  }
}

// ===== SALVAR CARD√ÅPIO NO GITHUB =====
async function salvar(){
  const cardapio = {
    horarioFuncionamento:{
      abertura:document.getElementById('abertura').value,
      fechamento:document.getElementById('fechamento').value
    },
    valoresMarmita:{}, cardapio:{}, refrigerantes:{ "Lata": [], "2 Litros": [] },
    locaisEntrega:[], formasPagamento:[]
  };

  document.querySelectorAll('#valoresMarmita .list-item').forEach(div=>{
    const inputs=div.querySelectorAll('input'); if(inputs[0].value) cardapio.valoresMarmita[inputs[0].value]=Number(inputs[1].value);
  });

  document.querySelectorAll('#cardapioDias .day-section').forEach(div=>{
    const dia=div.querySelector('h3').textContent;
    cardapio.cardapio[dia]={carnes:[],acompanhamentos:[]};
    div.querySelectorAll('.carnes input').forEach(i=>{if(i.value) cardapio.cardapio[dia].carnes.push(i.value);});
    div.querySelectorAll('.acompanhamentos input').forEach(i=>{if(i.value) cardapio.cardapio[dia].acompanhamentos.push(i.value);});
  });

  document.querySelectorAll('#refrigerantes .list-item').forEach(div=>{
    const tipo=div.dataset.tipo; const inputs=div.querySelectorAll('input');
    if(inputs[0].value) cardapio.refrigerantes[tipo].push({nome:inputs[0].value,preco:Number(inputs[1].value)});
  });

  document.querySelectorAll('#locaisEntrega .list-item').forEach(div=>{
    const inputs=div.querySelectorAll('input'); if(inputs[0].value) cardapio.locaisEntrega.push({nome:inputs[0].value,taxa:Number(inputs[1].value)});
  });

  document.querySelectorAll('#formasPagamento .list-item input').forEach(i=>{if(i.value) cardapio.formasPagamento.push(i.value);});

  try {
    const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE_PATH}`,{
      method:'PUT',
      headers:{
        'Authorization':'token '+TOKEN,
        'Content-Type':'application/json'
      },
      body:JSON.stringify({
        message:'Atualizando card√°pio via painel',
        content:btoa(JSON.stringify(cardapio, null, 2)),
        sha: SHA,
        branch:'main'
      })
    });
    const data = await res.json();
    if(data.content) { SHA = data.content.sha; alert('‚úÖ Card√°pio salvo no GitHub!'); }
    else alert('‚ùå Erro ao salvar: '+(data.message||'Desconhecido'));
  } catch(e){
    alert('‚ùå Erro ao salvar: '+e.message);
    console.error(e);
  }
}

// ===== INICIAR =====
carregar();
</script>

</body>
</html>
