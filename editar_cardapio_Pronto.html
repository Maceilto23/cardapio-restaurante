<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editar Card√°pio</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f5f5f5; }
h1 { color:#007BFF; text-align:center; margin-bottom:20px; }
.section { background:#fff; padding:15px 20px; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
.section h2 { color:#007BFF; margin-bottom:10px; font-size:1.2rem; }
label { display:block; margin-top:10px; font-weight:bold; }
input, textarea { width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #ccc; font-size:0.95rem; }
input[type="time"] { width:150px; }
textarea { resize: vertical; font-family: monospace; background:#f9f9f9; }
button { margin-top:15px; padding:12px; background:#28A745; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:bold; width:100%; font-size:1rem; transition: background 0.3s; }
button:hover { background:#218838; }
.small { font-size:0.85rem; color:#555; margin-top:2px; font-style:italic; }
.flex { display:flex; gap:8px; margin-bottom:8px; }
.flex input { flex:1; }
.add-btn { background:#007BFF; margin-top:5px; }
.add-btn:hover { background:#0056b3; }
.remove-btn {
  background:#dc3545;
  color:#fff;
  border:none;
  border-radius:4px;
  width:30px;
  height:30px;
  font-size:16px;
  line-height:1;
  cursor:pointer;
  flex-shrink:0;
}
.remove-btn:hover { background:#b02a37; }

</style>
</head>
<body>
<h1>Editar Card√°pio</h1>

<!-- Hor√°rio -->
<div class="section">
  <h2>Hor√°rio de Funcionamento</h2>
  <label>Hor√°rio de Abertura</label>
  <input type="time" id="abertura">
  <label>Hor√°rio de Fechamento</label>
  <input type="time" id="fechamento">
</div>

<!-- Marmitas -->
<div class="section">
  <h2>Marmitas</h2>
  <div id="marmitasContainer"></div>
  <button type="button" class="add-btn" id="addMarmita">‚ûï Adicionar Marmita</button>
</div>

<!-- Card√°pio Di√°rio -->
<div class="section">
  <h2>Card√°pio Di√°rio</h2>
  <div id="diasContainer"></div>
  <div class="small">Separe os itens por v√≠rgula. Ex: Arroz, Feij√£o, Salada</div>
</div>

<!-- Locais de entrega -->
<div class="section">
  <h2>Locais de Entrega</h2>
  <div id="locaisContainer"></div>
  <button type="button" class="add-btn" id="addLocal">‚ûï Adicionar Local</button>
  <div class="small">Formato: NomeBairro:Taxa. Ex: Bairro Central:5</div>
</div>

<!-- Formas de pagamento -->
<div class="section">
  <h2>Formas de Pagamento</h2>
  <input type="text" id="formasPagamento" placeholder="Ex: Dinheiro, PIX, Cart√£o">
  <div class="small">Separe por v√≠rgula.</div>
</div>

<button id="salvar">üíæ Salvar Altera√ß√µes</button>

<script src="cardapio.js"></script>
<script>
// Puxa card√°pio
let cardapioDataLS = JSON.parse(localStorage.getItem("cardapioData"));
let data = cardapioDataLS || cardapioData;

// --- Hor√°rio ---
document.getElementById("abertura").value = data.horarioFuncionamento.abertura;
document.getElementById("fechamento").value = data.horarioFuncionamento.fechamento;

// --- Marmitas ---
const marmitasContainer = document.getElementById("marmitasContainer");
function criarMarmita(nome="", valor=""){
  const div = document.createElement("div");
  div.classList.add("flex");
  div.innerHTML = `<input type="text" class="nomeMarmita" value="${nome}" placeholder="Nome da marmita">
                   <input type="number" class="valorMarmita" value="${valor}" placeholder="Valor">
                   <button type="button" class="remove-btn">‚ùå</button>`;
  div.querySelector(".remove-btn").addEventListener("click", ()=>div.remove());
  marmitasContainer.appendChild(div);
}
Object.entries(data.valoresMarmita).forEach(([nome,valor])=>criarMarmita(nome,valor));
document.getElementById("addMarmita").addEventListener("click", ()=>criarMarmita());

// --- Card√°pio Di√°rio ---
const diasContainer = document.getElementById("diasContainer");
Object.entries(data.cardapio).forEach(([dia, itens])=>{
  const div = document.createElement("div");
  div.classList.add("section", "day-section");
  div.innerHTML = `<h3>${dia.charAt(0).toUpperCase()+dia.slice(1)}</h3>
                   <label>Carnes:</label>
                   <input type="text" class="carnes" value="${itens.carnes.join(', ')}">
                   <label>Acompanhamentos:</label>
                   <input type="text" class="acompanhamentos" value="${itens.acompanhamentos.join(', ')}">`;
  diasContainer.appendChild(div);
});

// --- Locais de entrega ---
const locaisContainer = document.getElementById("locaisContainer");
function criarLocal(nome="", taxa=""){
  const div = document.createElement("div");
  div.classList.add("flex","local-section");
  div.innerHTML = `<input type="text" value="${nome}:${taxa}" placeholder="Nome:Taxa">
                   <button type="button" class="remove-btn">‚ùå</button>`;
  div.querySelector(".remove-btn").addEventListener("click", ()=>div.remove());
  locaisContainer.appendChild(div);
}
data.locaisEntrega.forEach(loc=>criarLocal(loc.nome,loc.taxa));
document.getElementById("addLocal").addEventListener("click", ()=>criarLocal());

// --- Formas de pagamento ---
document.getElementById("formasPagamento").value = data.formasPagamento.join(", ");

// --- Salvar ---
document.getElementById("salvar").addEventListener("click", ()=>{
  try{
    const novaData = {
      horarioFuncionamento:{
        abertura: document.getElementById("abertura").value,
        fechamento: document.getElementById("fechamento").value
      },
      valoresMarmita:{},
      cardapio:{},
      locaisEntrega:[],
      formasPagamento:[]
    };

    // Marmitas
    document.querySelectorAll("#marmitasContainer .flex").forEach(div=>{
      const nome = div.querySelector(".nomeMarmita").value.trim();
      const valor = parseFloat(div.querySelector(".valorMarmita").value);
      if(nome && !isNaN(valor)) novaData.valoresMarmita[nome]=valor;
    });

    // Card√°pio di√°rio
    document.querySelectorAll(".day-section").forEach(div=>{
      const dia = div.querySelector("h3").textContent.toLowerCase();
      const carnes = div.querySelector(".carnes").value.split(",").map(i=>i.trim()).filter(Boolean);
      const acomp = div.querySelector(".acompanhamentos").value.split(",").map(i=>i.trim()).filter(Boolean);
      novaData.cardapio[dia] = { carnes, acompanhamentos: acomp };
    });

    // Locais de entrega
    document.querySelectorAll(".local-section input").forEach(inp=>{
      const [nome,taxa] = inp.value.split(":").map(i=>i.trim());
      if(nome && taxa) novaData.locaisEntrega.push({nome, taxa:parseFloat(taxa)});
    });

    // Formas de pagamento
    novaData.formasPagamento = document.getElementById("formasPagamento").value.split(",").map(i=>i.trim()).filter(Boolean);

    localStorage.setItem("cardapioData", JSON.stringify(novaData));
    alert("‚úÖ Card√°pio salvo com sucesso!");
  }catch(e){
    console.error(e);
    alert("‚ùå Erro ao salvar! Verifique os campos.");
  }
});
</script>
</body>
</html>
