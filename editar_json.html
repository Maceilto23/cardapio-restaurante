<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de Cardápio GitHub</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  h2 { color: #007BFF; text-align: center; }
  textarea { width: 100%; height: 400px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-family: monospace; font-size: 14px; }
  input, button { padding: 10px; border-radius: 6px; border: 1px solid #ccc; margin: 5px 0; width: 100%; }
  button { cursor: pointer; font-weight: bold; border: none; color: #fff; }
  .btn-send { background: #28A745; }
</style>
</head>
<body>

<h2>Editor de Cardápio GitHub</h2>

<label>Token do GitHub (Pessoal, com permissão de escrita):</label>
<input type="password" id="tokenInput" placeholder="Insira seu token">

<label>Conteúdo do cardápio:</label>
<textarea id="jsonEditor"></textarea>

<button class="btn-send" id="sendGitHub">Enviar para GitHub</button>

<script>
let jsonData = null;
let fileSha = null; // SHA do arquivo no GitHub
const owner = "SEU_USUARIO"; // Substitua pelo seu usuário
const repo = "SEU_REPOSITORIO"; // Substitua pelo nome do repositório
const path = "cardapio.json"; // Caminho do arquivo no repositório

// Função para carregar cardápio do GitHub
async function carregarCardapio() {
  try {
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`);
    const data = await res.json();
    fileSha = data.sha;
    const conteudo = decodeURIComponent(escape(atob(data.content)));
    jsonData = JSON.parse(conteudo);
    document.getElementById("jsonEditor").value = JSON.stringify(jsonData, null, 2);
  } catch(err) {
    console.error(err);
    alert("Erro ao carregar o cardápio do GitHub. Verifique usuário, repositório ou token.");
  }
}

// Enviar alterações para o GitHub
document.getElementById("sendGitHub").addEventListener("click", async () => {
  const token = document.getElementById("tokenInput").value.trim();
  if (!token) { alert("Insira o token do GitHub!"); return; }

  try {
    const contentBase64 = btoa(unescape(encodeURIComponent(document.getElementById("jsonEditor").value)));

    const resPut = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${token}`,
        "Accept": "application/vnd.github+json"
      },
      body: JSON.stringify({
        message: "Atualização do cardápio via editor web",
        content: contentBase64,
        sha: fileSha
      })
    });

    const dataPut = await resPut.json();
    if (dataPut.content) {
      alert("✅ Cardápio enviado com sucesso!");
      fileSha = dataPut.content.sha; // Atualiza SHA para próximas alterações
    } else {
      console.error(dataPut);
      alert("❌ Erro ao enviar. Veja o console.");
    }

  } catch(err) {
    console.error(err);
    alert("❌ Ocorreu um erro. Veja o console.");
  }
});

// Carregar ao abrir a página
carregarCardapio();
</script>

</body>
</html>
