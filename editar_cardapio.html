<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de cardapio.json</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
h2 { margin-top: 30px; }
label { display: block; margin-top: 10px; }
input, textarea { width: 100%; padding: 5px; margin-top: 5px; }
button { margin-top: 15px; padding: 10px 20px; cursor: pointer; }
</style>
</head>
<body>

<h1>Editor de cardapio.json</h1>
<form id="formCardapio">

<h2>Horário de Funcionamento</h2>
<label>Abertura: <input type="time" id="abertura"></label>
<label>Fechamento: <input type="time" id="fechamento"></label>

<h2>Valores Marmita</h2>
<label>Pequena: <input type="number" id="valorPequena"></label>
<label>Grande: <input type="number" id="valorGrande"></label>

<h2>Cardápio Semanal</h2>
<div id="cardapioDias"></div>

<h2>Locais de Entrega</h2>
<div id="locaisEntrega"></div>
<button type="button" onclick="addLocal()">Adicionar Local</button>

<h2>Formas de Pagamento</h2>
<label>Separe por vírgula: <input type="text" id="formasPagamento"></label>

<button type="button" onclick="salvarJSON()">Salvar Alterações</button>
<button type="button" onclick="baixarJSON()">Baixar JSON</button>
<p id="mensagem"></p>
</form>

<script>
let cardapioJSON = {};

// Função para preencher os campos do formulário
function preencherCampos() {
  document.getElementById('abertura').value = cardapioJSON.horarioFuncionamento.abertura;
  document.getElementById('fechamento').value = cardapioJSON.horarioFuncionamento.fechamento;
  document.getElementById('valorPequena').value = cardapioJSON.valoresMarmita.Pequena;
  document.getElementById('valorGrande').value = cardapioJSON.valoresMarmita.Grande;

  const cardapioDias = document.getElementById('cardapioDias');
  cardapioDias.innerHTML = '';
  for (let dia in cardapioJSON.cardapio) {
    const div = document.createElement('div');
    div.innerHTML = `<h3>${dia}</h3>
      <label>Carnes (separadas por vírgula): <input type="text" data-dia="${dia}" data-tipo="carnes" value="${cardapioJSON.cardapio[dia].carnes.join(', ')}"></label>
      <label>Acompanhamentos (separados por vírgula): <input type="text" data-dia="${dia}" data-tipo="acompanhamentos" value="${cardapioJSON.cardapio[dia].acompanhamentos.join(', ')}"></label>`;
    cardapioDias.appendChild(div);
  }

  const locaisDiv = document.getElementById('locaisEntrega');
  locaisDiv.innerHTML = '';
  cardapioJSON.locaisEntrega.forEach((local, idx) => {
    const div = document.createElement('div');
    div.innerHTML = `
      <label>Nome: <input type="text" data-idx="${idx}" data-campo="nome" value="${local.nome}"></label>
      <label>Taxa: <input type="number" step="0.01" data-idx="${idx}" data-campo="taxa" value="${local.taxa}"></label>
      <button type="button" onclick="removerLocal(${idx})">Remover</button>`;
    locaisDiv.appendChild(div);
  });

  document.getElementById('formasPagamento').value = cardapioJSON.formasPagamento.join(', ');
}

// Carregar cardapio.json do GitHub
fetch('cardapio.json')
  .then(response => response.json())
  .then(data => {
    cardapioJSON = data;
    preencherCampos();
  })
  .catch(err => {
    document.getElementById('mensagem').innerText = 'Erro ao carregar cardapio.json: ' + err;
  });

// Salvar alterações no LocalStorage
function salvarJSON() {
  cardapioJSON.horarioFuncionamento.abertura = document.getElementById('abertura').value;
  cardapioJSON.horarioFuncionamento.fechamento = document.getElementById('fechamento').value;
  cardapioJSON.valoresMarmita.Pequena = parseFloat(document.getElementById('valorPequena').value);
  cardapioJSON.valoresMarmita.Grande = parseFloat(document.getElementById('valorGrande').value);

  document.querySelectorAll('#cardapioDias input').forEach(input => {
    const dia = input.dataset.dia;
    const tipo = input.dataset.tipo;
    cardapioJSON.cardapio[dia][tipo] = input.value.split(',').map(s => s.trim()).filter(s => s);
  });

  document.querySelectorAll('#locaisEntrega input').forEach(input => {
    const idx = parseInt(input.dataset.idx);
    const campo = input.dataset.campo;
    if (campo === 'nome') cardapioJSON.locaisEntrega[idx].nome = input.value;
    if (campo === 'taxa') cardapioJSON.locaisEntrega[idx].taxa = parseFloat(input.value);
  });

  cardapioJSON.formasPagamento = document.getElementById('formasPagamento').value.split(',').map(s => s.trim()).filter(s => s);

  localStorage.setItem('cardapioJSON', JSON.stringify(cardapioJSON, null, 2));
  document.getElementById('mensagem').innerText = 'Alterações salvas no LocalStorage!';
}

// Adicionar novo local
function addLocal() {
  cardapioJSON.locaisEntrega.push({nome:'', taxa:0});
  preencherCampos();
}

// Remover local
function removerLocal(idx) {
  cardapioJSON.locaisEntrega.splice(idx,1);
  preencherCampos();
}

// Baixar JSON atualizado
function baixarJSON() {
  const blob = new Blob([JSON.stringify(cardapioJSON, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'cardapio.json';
  a.click();
  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
