<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card√°pio Interativo</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 10px; }
.cardapio { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); max-width: 500px; width: 100%; margin-bottom: 20px; }
.logo-container { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px; }
.logo-container img { height: 60px; margin-right: 15px; border-radius: 8px; }
.titulo-container h1 { font-size: 1.5rem; color: #007BFF; margin-bottom: 5px; }
.titulo-container h2 { font-size: 1.1rem; color: #555; font-weight: normal; }
.titulo-container h3 { font-size: 1rem; margin-bottom: 10px; color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; cursor: pointer; display: flex; align-items: center; padding: 6px 10px; border-radius: 8px; transition: background 0.2s; }
li:hover { background: #f0f0f0; }
li.selected { background: #d4f0d4; }
#adicionais, input[type="text"], select { width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
#enviarWhats { margin-top: 12px; padding: 10px; background: #25D366; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }
label { display: block; margin-bottom: 6px; cursor: pointer; }
.marmita-options label { display: block; margin-bottom: 8px; cursor: pointer; }
.marmita-options input { margin-right: 8px; }
@media (max-width: 600px) { 
  .logo-container { flex-direction: column; align-items: center; text-align: center; } 
  .logo-container img { margin-right: 0; margin-bottom: 8px; height: 50px; } 
  .titulo-container h1 { font-size: 1.3rem; } 
  .titulo-container h2 { font-size: 1rem; } 
  #enviarWhats { font-size: 0.95rem; } 
}
</style>
</head>
<body>

<div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>üçΩÔ∏è Card√°pio de Hoje ‚Äì <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Hor√°rio: --:-- - --:--</h3>
    </div>
  </div>

  <div class="marmita-options">
    <h3>üç± Escolha o tipo de Marmita</h3>
  </div>

  <h3>üçñ Carnes</h3>
  <ul id="carnes"></ul>

  <h3>ü•ó Acompanhamentos</h3>
  <ul id="acompanhamentos"></ul>

  <h3>ü•§ Refrigerantes</h3>
  <ul id="refrigerantes"></ul>

  <h3>Adicionais:</h3>
  <input type="text" id="adicionais" placeholder="Digite adicionais separados por v√≠rgula">

  <div class="cliente-info">
    <label for="nomeCliente">Nome do Cliente:</label>
    <input type="text" id="nomeCliente" placeholder="Digite seu nome">
    <label for="enderecoCliente">Endere√ßo:</label>
    <input type="text" id="enderecoCliente" placeholder="Digite o endere√ßo de entrega">
  </div>

  <h3>üìç Local de Entrega</h3>
  <select id="localEntrega"></select>

  <h3>üí≥ Formas de Pagamento</h3>
  <ul id="formasPagamentoList"></ul>

  <button id="enviarWhats">Enviar Pedido + PDF</button>

  <h3>üìã Pedido Selecionado</h3>
  <ul id="itensPedido"><li>Nenhum item selecionado</li></ul>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// --- Dia e data ---
const dias = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
const hoje = new Date();
document.getElementById("diaSemana").textContent = dias[hoje.getDay()];
document.getElementById("dataHoje").textContent = hoje.toLocaleDateString();

// --- Carrega card√°pio ---
async function carregarCardapio() {
    const res = await fetch("cardapio.json");
    const data = await res.json();

    // Hor√°rio
    const {abertura, fechamento} = data.horarioFuncionamento;
    document.getElementById("horarioFuncionamento").textContent = `Hor√°rio: ${abertura} - ${fechamento}`;

    // Marmitas
    const marmitaContainer = document.querySelector(".marmita-options");
    Object.entries(data.valoresMarmita).forEach(([nome, preco]) => {
        const label = document.createElement("label");
        const input = document.createElement("input");
        input.type = "radio";
        input.name = "marmita";
        input.value = nome;
        input.dataset.preco = preco; // agora pegamos o pre√ßo diretamente
        label.appendChild(input);
        label.append(` ${nome} - R$${preco.toFixed(2)}`);
        marmitaContainer.appendChild(label);
    });

    // Card√°pio do dia
    const diasSemana = ["domingo","segunda-feira","ter√ßa-feira","quarta-feira","quinta-feira","sexta-feira","s√°bado"];
    const cardapioDia = data.cardapio[diasSemana[hoje.getDay()]];

    // Carnes
    const carnesEl = document.getElementById("carnes");
    cardapioDia.carnes.forEach(item=>{
        const li = document.createElement("li");
        li.textContent = item;
        li.addEventListener("click",()=>li.classList.toggle("selected"));
        carnesEl.appendChild(li);
    });

    // Acompanhamentos
    const acompEl = document.getElementById("acompanhamentos");
    cardapioDia.acompanhamentos.forEach(item=>{
        const li = document.createElement("li");
        li.textContent = item;
        li.addEventListener("click",()=>li.classList.toggle("selected"));
        acompEl.appendChild(li);
    });

    // Refrigerantes
    const refriEl = document.getElementById("refrigerantes");
    Object.values(data.refrigerantes).flat().forEach(r=>{
        const li = document.createElement("li");
        li.textContent = `${r.nome} - R$${r.preco.toFixed(2)}`;
        li.dataset.preco = r.preco;
        li.addEventListener("click",()=>li.classList.toggle("selected"));
        refriEl.appendChild(li);
    });

    // Locais de entrega
    const localEl = document.getElementById("localEntrega");
    data.locaisEntrega.forEach(local=>{
        const option = document.createElement("option");
        option.value = local.nome;
        option.textContent = `${local.nome} - Taxa R$${local.taxa.toFixed(2)}`;
        option.dataset.taxa = local.taxa;
        localEl.appendChild(option);
    });

    // Formas de pagamento
    const pagamentoEl = document.getElementById("formasPagamentoList");
    data.formasPagamento.forEach(p=>{
        const li = document.createElement("li");
        li.textContent = p;
        li.addEventListener("click",()=>{
            pagamentoEl.querySelectorAll("li").forEach(x=>x.classList.remove("selected"));
            li.classList.add("selected");
        });
        pagamentoEl.appendChild(li);
    });
}

// --- Atualiza itens selecionados ---
function atualizarItensSelecionados() {
    const itensPedidoEl = document.getElementById("itensPedido");
    const marmita = document.querySelector(".marmita-options input:checked")?.value;
    const selecionados = [...document.querySelectorAll("#carnes li.selected, #acompanhamentos li.selected, #refrigerantes li.selected")].map(li=>li.textContent);
    const adicionais = document.getElementById("adicionais").value.split(",").map(a=>a.trim()).filter(a=>a);
    itensPedidoEl.innerHTML = "";
    if(marmita) itensPedidoEl.innerHTML += `<li>Marmita: ${marmita}</li>`;
    selecionados.forEach(item=>itensPedidoEl.innerHTML += `<li>${item}</li>`);
    adicionais.forEach(a=>itensPedidoEl.innerHTML += `<li>Adicional: ${a}</li>`);
}

// --- PDF + WhatsApp ---
async function enviarPedido() {
    atualizarItensSelecionados();

    const nomeCliente = document.getElementById("nomeCliente").value || "Cliente";
    const endereco = document.getElementById("enderecoCliente").value || "N√£o informado";
    const localEntrega = document.getElementById("localEntrega").value;
    
    const marmitaEl = document.querySelector(".marmita-options input:checked");
    if (!marmitaEl) { alert("Selecione a marmita!"); return; }
    const marmita = marmitaEl.value;
    const valorMarmita = parseFloat(marmitaEl.dataset.preco || 0); // usa dataset

    const adicionais = document.getElementById("adicionais").value.split(",").map(a=>a.trim()).filter(a=>a);
    const pedidoItens = [...document.querySelectorAll("#carnes li.selected, #acompanhamentos li.selected, #refrigerantes li.selected")].map(li=>li.textContent);
    const taxaEntrega = parseFloat(document.getElementById("localEntrega").selectedOptions[0].dataset.taxa || 0);
    const pagamento = document.querySelector("#formasPagamentoList li.selected")?.textContent || "N√£o informado";

    const total = valorMarmita + taxaEntrega + [...document.querySelectorAll("#refrigerantes li.selected")].reduce((acc,li)=>acc + parseFloat(li.dataset.preco || 0),0);

    // --- PDF ---
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: [80, 200] });
    let y = 10;
    const margem = 5;

    doc.setFont("courier","bold");
    doc.setFontSize(12);
    doc.text("Restaurante Colinas", 40, y, {align:"center"}); y+=6;

    doc.setFont("courier","normal");
    doc.setFontSize(10);
    doc.text(`Cliente: ${nomeCliente}`, margem, y); y+=5;
    doc.text(`Endere√ßo: ${endereco}`, margem, y); y+=5;
    doc.text(`Local de entrega: ${localEntrega}`, margem, y); y+=7;

    doc.setFont("courier","bold");
    doc.text("Itens do Pedido:", margem, y); y+=5;
    doc.setFont("courier","normal");
    doc.text(`- Marmita: ${marmita} .... R$${valorMarmita.toFixed(2)}`, margem+2, y); y+=5;
    pedidoItens.forEach(item=>{ doc.text(`  - ${item}`, margem+4, y); y+=4; });
    adicionais.forEach(add=>{ doc.text(`  - Adicional: ${add}`, margem+4, y); y+=4; });

    y+=2;
    doc.setFont("courier","bold");
    doc.text(`Taxa de entrega: R$${taxaEntrega.toFixed(2)}`, margem, y); y+=5;
    doc.text(`Pagamento: ${pagamento}`, margem, y); y+=5;
    doc.text(`Total: R$${total.toFixed(2)}`, margem, y); y+=7;

    doc.setFont("courier","normal");
    doc.text("Obrigado pela prefer√™ncia!", 40, y, {align:"center"});

    const pdfBlob = doc.output("blob");
    const pdfUrl = URL.createObjectURL(pdfBlob);
    const a = document.createElement("a");
    a.href = pdfUrl;
    a.download = `pedido_${nomeCliente}.pdf`;
    document.body.appendChild(a); a.click(); document.body.removeChild(a);

    const numeroRestaurante = "5511999999999"; 
    const mensagem = `Ol√°! Segue o pedido do cliente ${nomeCliente}. Favor verificar o PDF gerado para impress√£o.`;
    const url = `https://web.whatsapp.com/send?phone=${numeroRestaurante}&text=${encodeURIComponent(mensagem)}`;
    window.open(url, "_blank");
}

// --- Eventos ---
document.addEventListener("click", e=>{ if(e.target.tagName==="LI") atualizarItensSelecionados(); });
document.getElementById("adicionais").addEventListener("input", atualizarItensSelecionados);
document.querySelector(".marmita-options").addEventListener("change", atualizarItensSelecionados);
document.getElementById("enviarWhats").addEventListener("click", enviarPedido);
window.addEventListener("DOMContentLoaded", carregarCardapio);

</script>
</body>
</html>
