<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cardápio Interativo</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 10px; }
.cardapio { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); max-width: 500px; width: 100%; margin-bottom: 20px; }
.logo-container { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px; }
.logo-container img { height: 60px; margin-right: 15px; border-radius: 8px; }
.titulo-container h1 { font-size: 1.5rem; color: #007BFF; margin-bottom: 5px; }
.titulo-container h2 { font-size: 1.1rem; color: #555; font-weight: normal; }
.titulo-container h3 { font-size: 1rem; margin-bottom: 10px; color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; cursor: pointer; display: flex; align-items: center; padding: 6px 10px; border-radius: 8px; transition: background 0.2s; }
li:hover { background: #f0f0f0; }
li.selected { background: #007BFF; color: #fff; }
#adicionais, input[type="text"], select { width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
#enviarWhats { margin-top: 12px; padding: 10px; background: #25D366; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }
#adicionarPedido { margin: 10px 0; padding: 8px; width: 100%; border-radius: 8px; border: 1px solid #007BFF; background: #007BFF; color: #fff; cursor: pointer; font-weight: bold; }
.pedido-individual { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; background: #f9f9f9; }
.pedido-individual h4 { margin-bottom: 5px; }
@media (max-width: 600px) { 
  .logo-container { flex-direction: column; align-items: center; text-align: center; } 
  .logo-container img { margin-right: 0; margin-bottom: 8px; height: 50px; } 
  .titulo-container h1 { font-size: 1.3rem; } 
  .titulo-container h2 { font-size: 1rem; } 
  #enviarWhats, #adicionarPedido { font-size: 0.95rem; } 
}
</style>
</head>
<body>

<div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>Cardápio de Hoje – <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Horário: --:-- - --:--</h3>
    </div>
  </div>

  <button id="adicionarPedido">➕ Adicionar Pedido de Outra Pessoa</button>
  <div id="pedidosContainer"></div>

  <h3>Pedidos Selecionados</h3>
  <ul id="itensPedido"><li>Nenhum pedido adicionado</li></ul>

  <button id="enviarWhats">Enviar todos via WhatsApp</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const diasSemana = ["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"];
const hojeDate = new Date();
document.getElementById("diaSemana").innerText = diasSemana[hojeDate.getDay()];
const dia = String(hojeDate.getDate()).padStart(2,'0');
const mes = String(hojeDate.getMonth()+1).padStart(2,'0');
const ano = hojeDate.getFullYear();
document.getElementById("dataHoje").innerText = `${dia}/${mes}/${ano}`;

let pedidos = [];
let cardapioFinal = null;

// Carregar cardápio
fetch('cardapio.json?t=' + new Date().getTime())
  .then(res => res.json())
  .then(data => {
    cardapioFinal = data;
    document.getElementById("horarioFuncionamento").textContent = 
      `Horário: ${data.horarioFuncionamento.abertura} - ${data.horarioFuncionamento.fechamento}`;
  });

// Criar pedido
function criarPedido() {
  if(!cardapioFinal) { alert("Aguarde o carregamento do cardápio..."); return; }

  const index = pedidos.length;
  const pedidoObj = { nome:"", endereco:"", local:"", marmita:"", carnes:[], acompanhamentos:[], refrigerantes:[], adicionais:"", pagamento:"", taxaEntrega:0, total:0 };
  pedidos.push(pedidoObj);

  const container = document.createElement("div");
  container.classList.add("pedido-individual");
  container.dataset.index = index;

  container.innerHTML = `
    <h4>Pedido da Pessoa ${index+1}</h4>
    <label>Nome:</label><input type="text" class="nomeCliente" placeholder="Nome do cliente">
    <label>Endereço:</label><input type="text" class="enderecoCliente" placeholder="Endereço de entrega">
    <label>Local de Entrega:</label><select class="localEntrega"></select>

    <div class="marmita-options"><h4>Tipo de Marmita</h4></div>
    <h4>Carnes</h4><ul class="carnes"></ul>
    <h4>Acompanhamentos</h4><ul class="acompanhamentos"></ul>
    <h4>Refrigerantes</h4><ul class="refrigerantes"></ul>
    <label>Adicionais:</label><input type="text" class="adicionais" placeholder="Digite adicionais">
    <h4>Formas de Pagamento</h4><ul class="formasPagamentoList"></ul>
  `;

  document.getElementById("pedidosContainer").appendChild(container);

  const marmitaContainer = container.querySelector(".marmita-options");
  let limiteCarnes = 0;
  let carnesSelecionadas = [];
  let refrigerantesSelecionados = [];

  // Marmita
  Object.keys(cardapioFinal.valoresMarmita).forEach(key => {
    const label = document.createElement("label");
    label.innerHTML = `<input type="radio" name="marmita${index}" value="${key}"> ${key} - R$${cardapioFinal.valoresMarmita[key]}`;
    label.querySelector("input").addEventListener("change", ()=>{
      pedidoObj.marmita = key;
      pedidoObj.valorMarmita = cardapioFinal.valoresMarmita[key];
      limiteCarnes = key.includes("01") ? 1 : key.includes("02") ? 2 : 0;
      carnesSelecionadas = [];
      container.querySelectorAll(".carnes li").forEach(li=>li.classList.remove("selected"));
      atualizarPedido();
    });
    marmitaContainer.appendChild(label);
  });

  function criarLista(itens, ulContainer, tipo){
    ulContainer.innerHTML = "";
    itens.forEach(i=>{
      const li = document.createElement("li");
      li.setAttribute("data-item", i);
      li.textContent = i;
      li.addEventListener("click", ()=>{
        if(tipo==="carnes"){
          if(!li.classList.contains("selected") && carnesSelecionadas.length>=limiteCarnes) return;
        }
        li.classList.toggle("selected");
        const item = li.getAttribute("data-item");
        if(li.classList.contains("selected")){
          if(tipo==="carnes") carnesSelecionadas.push(item);
          else if(tipo==="acompanhamentos") pedidoObj.acompanhamentos.push(item);
          else if(tipo==="refrigerantes") refrigerantesSelecionados.push({nome:item, preco: parseFloat(item.split("R$")[1]||0)});
        } else {
          if(tipo==="carnes") carnesSelecionadas = carnesSelecionadas.filter(x=>x!==item);
          else if(tipo==="acompanhamentos") pedidoObj.acompanhamentos = pedidoObj.acompanhamentos.filter(x=>x!==item);
          else if(tipo==="refrigerantes") refrigerantesSelecionados = refrigerantesSelecionados.filter(r=>r.nome!==item);
        }
        atualizarPedido();
      });
      ulContainer.appendChild(li);
    });
  }

  const hojeCardapio = cardapioFinal.cardapio[diasSemana[hojeDate.getDay()].toLowerCase()] || { carnes: [], acompanhamentos: [] };
  criarLista(hojeCardapio.carnes, container.querySelector(".carnes"), "carnes");
  criarLista(hojeCardapio.acompanhamentos, container.querySelector(".acompanhamentos"), "acompanhamentos");

  const refItems = Object.entries(cardapioFinal.refrigerantes).flatMap(([tipo,list])=>list.map(r=>`${tipo} - ${r.nome} R$${r.preco}`));
  criarLista(refItems, container.querySelector(".refrigerantes"), "refrigerantes");

  // Locais
  const localEl = container.querySelector(".localEntrega");
  cardapioFinal.locaisEntrega.forEach((loc,i)=>{
    const opt = document.createElement("option");
    opt.value = loc.nome;
    opt.dataset.taxa = loc.taxa;
    opt.textContent = `${loc.nome} - R$${loc.taxa.toFixed(2)}`;
    if(i===0) pedidoObj.taxaEntrega = loc.taxa;
    localEl.appendChild(opt);
  });
  localEl.addEventListener("change", ()=>{ pedidoObj.taxaEntrega = parseFloat(localEl.selectedOptions[0].dataset.taxa); atualizarPedido(); });

  // Formas de pagamento
  const formasEl = container.querySelector(".formasPagamentoList");
  cardapioFinal.formasPagamento.forEach(f=>{
    const li = document.createElement("li"); li.textContent = f;
    li.addEventListener("click", ()=>{
      formasEl.querySelectorAll("li").forEach(l=>l.classList.remove("selected"));
      li.classList.add("selected");
      pedidoObj.pagamento = f;
      atualizarPedido();
    });
    formasEl.appendChild(li);
  });

  // Inputs
  container.querySelector(".nomeCliente").addEventListener("input", e=>{ pedidoObj.nome = e.target.value; atualizarPedido(); });
  container.querySelector(".enderecoCliente").addEventListener("input", e=>{ pedidoObj.endereco = e.target.value; atualizarPedido(); });
  container.querySelector(".adicionais").addEventListener("input", e=>{ pedidoObj.adicionais = e.target.value; atualizarPedido(); });

  function atualizarPedido(){
    pedidoObj.carnes = carnesSelecionadas;
    pedidoObj.refrigerantes = refrigerantesSelecionados;
    const totalRef = refrigerantesSelecionados.reduce((sum,r)=>sum+r.preco,0);
    pedidoObj.total = (pedidoObj.valorMarmita||0) + totalRef + (pedidoObj.taxaEntrega||0);

    // Atualizar lista de pedidos
    const itensEl = document.getElementById("itensPedido");
    if(pedidos.length===0){ itensEl.innerHTML = "<li>Nenhum pedido adicionado</li>"; return; }
    let html = "";
    pedidos.forEach((p,i)=>{
      html += `<li><strong>Pedido ${i+1} - ${p.nome || "Cliente"}:</strong><ul>`;
      if(p.marmita) html += `<li>Marmita: ${p.marmita} - R$${p.valorMarmita}</li>`;
      if(p.carnes) p.carnes.forEach(c=>html += `<li>Carne: ${c}</li>`);
      if(p.acompanhamentos) p.acompanhamentos.forEach(a=>html += `<li>Acompanhamento: ${a}</li>`);
      if(p.refrigerantes) p.refrigerantes.forEach(r=>html += `<li>Bebida: ${r.nome} - R$${r.preco}</li>`);
      if(p.adicionais) html += `<li>Obs: ${p.adicionais}</li>`;
      if(p.pagamento) html += `<li>Pagamento: ${p.pagamento}</li>`;
      if(p.local) html += `<li>Local: ${p.local}</li>`;
      if(p.endereco) html += `<li>Endereço: ${p.endereco}</li>`;
      html += `<li>Taxa entrega: R$${(p.taxaEntrega||0).toFixed(2)}</li>`;
      html += `<li>Subtotal: R$${(p.total||0).toFixed(2)}</li>`;
      html += `</ul></li>`;
    });
    const totalGeral = pedidos.reduce((sum,p)=>sum+(p.total||0),0);
    html += `<li><strong>Total Geral: R$${totalGeral.toFixed(2)}</strong></li>`;
    itensEl.innerHTML = html;
  }

  atualizarPedido();
}

// Botões
document.getElementById("adicionarPedido").addEventListener("click", criarPedido);

document.getElementById("enviarWhats").addEventListener("click", ()=>{
  if(pedidos.length===0){ alert("Nenhum pedido adicionado."); return; }
  let msg = "Pedidos do Dia:\n";
  pedidos.forEach((p,i)=>{
    msg += `Pedido ${i+1} - ${p.nome || "Cliente"}\n`;
    if(p.marmita) msg += `Marmita: ${p.marmita} - R$${p.valorMarmita}\n`;
    if(p.carnes) p.carnes.forEach(c=>msg += `Carne: ${c}\n`);
    if(p.acompanhamentos) p.acompanhamentos.forEach(a=>msg += `Acomp.: ${a}\n`);
    if(p.refrigerantes) p.refrigerantes.forEach(r=>msg += `Bebida: ${r.nome} - R$${r.preco}\n`);
    if(p.adicionais) msg += `Obs: ${p.adicionais}\n`;
    if(p.pagamento) msg += `Pagamento: ${p.pagamento}\n`;
    if(p.local) msg += `Local: ${p.local}\n`;
    if(p.endereco) msg += `Endereço: ${p.endereco}\n`;
    msg += `Taxa entrega: R$${(p.taxaEntrega||0).toFixed(2)}\n`;
    msg += `Subtotal: R$${(p.total||0).toFixed(2)}\n`;
  });
  const totalGeral = pedidos.reduce((sum,p)=>sum+(p.total||0),0);
  msg += `Total Geral: R$${totalGeral.toFixed(2)}`;
  window.open(`https://wa.me/+556192633504?text=${encodeURIComponent(msg)}`, "_blank");

  // Gerar PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation:'portrait', unit:'pt', format:[226,1000] });

  doc.setFont('helvetica','bold'); doc.setFontSize(14);
  doc.text('Restaurante Colinas', 113, 20, {align:'center'});
  doc.setFont('helvetica','normal'); doc.setFontSize(10);
  doc.text(`Pedidos de ${dia}/${mes}/${ano}`, 113, 35, {align:'center'});

  let y = 55;
  pedidos.forEach((p,i)=>{
    doc.setFont('helvetica','bold'); doc.text(`PEDIDO ${i+1} - ${p.nome||"Cliente"}`,10,y); y+=12;
    if(p.local){ doc.setFont('helvetica','normal'); doc.text(`Local: ${p.local}`,15,y); y+=12; }
    if(p.endereco) doc.text(`Endereço: ${p.endereco}`,15,y); y+=12;
    if(p.marmita) doc.text(`Marmita: ${p.marmita}  R$${p.valorMarmita}`,10,y); y+=12;
    p.carnes?.forEach(c=>{ doc.text(`Carne: ${c}`,15,y); y+=12; });
    p.acompanhamentos?.forEach(a=>{ doc.text(`Acomp.: ${a}`,15,y); y+=12; });
    p.refrigerantes?.forEach(r=>{ doc.text(`Bebida: ${r.nome}  R$${r.preco}`,15,y); y+=12; });
    if(p.adicionais) doc.text(`Obs: ${p.adicionais}`,15,y); y+=12;
    if(p.pagamento) doc.text(`Pagamento: ${p.pagamento}`,15,y); y+=12;
    doc.text(`Taxa entrega: R$${(p.taxaEntrega||0).toFixed(2)}`,15,y); y+=12;
    doc.setFont('helvetica','bold'); doc.text(`Subtotal: R$${(p.total||0).toFixed(2)}`,15,y); y+=15;
  });
  doc.setFont('helvetica','bold'); doc.text(`TOTAL GERAL: R$${totalGeral.toFixed(2)}`,10,y);
  doc.save(`pedido_${dia}${mes}${ano}.pdf`);
});
</script>

</body>
</html>
