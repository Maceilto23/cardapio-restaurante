<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card√°pio Interativo</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 10px; }
.cardapio { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); max-width: 500px; width: 100%; margin-bottom: 20px; }
.logo-container { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px; }
.logo-container img { height: 60px; margin-right: 15px; border-radius: 8px; }
.titulo-container h1 { font-size: 1.5rem; color: #007BFF; margin-bottom: 5px; }
.titulo-container h2 { font-size: 1.1rem; color: #555; font-weight: normal; }
.titulo-container h3 { font-size: 1rem; margin-bottom: 10px; color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; cursor: pointer; display: flex; align-items: center; padding: 6px 10px; border-radius: 8px; transition: background 0.2s; }
li:hover { background: #f0f0f0; }
.checkbox-fake { width: 22px; height: 22px; border: 2px solid #007BFF; display: flex; align-items: center; justify-content: center; margin-right: 10px; border-radius: 4px; font-weight: bold; color: #fff; background: #007BFF; opacity: 0; transition: opacity 0.2s, transform 0.2s; flex-shrink: 0; }
li.selected .checkbox-fake { opacity: 1; transform: scale(1.1); }
li span { flex: 1; }
#adicionais, input[type="text"], select { width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
#enviarWhats { margin-top: 12px; padding: 10px; background: #25D366; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }
label { display: block; margin-bottom: 6px; cursor: pointer; }
.marmita-options label { display: block; margin-bottom: 8px; cursor: pointer; }
.marmita-options input { margin-right: 8px; }
#adicionarPedido { margin: 10px 0; padding: 8px; width: 100%; border-radius: 8px; border: 1px solid #007BFF; background: #007BFF; color: #fff; cursor: pointer; font-weight: bold; }
.pedido-individual { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; background: #f9f9f9; }
.pedido-individual h4 { margin-bottom: 5px; }
@media (max-width: 600px) { 
  .logo-container { flex-direction: column; align-items: center; text-align: center; } 
  .logo-container img { margin-right: 0; margin-bottom: 8px; height: 50px; } 
  .titulo-container h1 { font-size: 1.3rem; } 
  .titulo-container h2 { font-size: 1rem; } 
  #enviarWhats, #adicionarPedido { font-size: 0.95rem; } 
}
</style>
</head>
<body>

<div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>üçΩÔ∏è Card√°pio de Hoje ‚Äì <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Hor√°rio: --:-- - --:--</h3>
    </div>
  </div>

  <button id="adicionarPedido">‚ûï Adicionar Pedido de Outra Pessoa</button>

  <div id="pedidosContainer"></div>

  <h3>üìã Pedidos Selecionados</h3>
  <ul id="itensPedido"><li>Nenhum pedido adicionado</li></ul>

  <button id="enviarWhats">Enviar todos via WhatsApp</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const diasSemana = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
const hoje = new Date();
document.getElementById("diaSemana").textContent = diasSemana[hoje.getDay()];
document.getElementById("dataHoje").textContent = hoje.toLocaleDateString("pt-BR");

// Vari√°vel global com o card√°pio
let cardapio = null;

// Carrega o card√°pio.json
async function carregarCardapio() {
  try {
    const resp = await fetch("cardapio.json");
    cardapio = await resp.json();
  } catch (e) {
    console.error("Erro ao carregar cardapio.json", e);
  }
}

// Cria um novo bloco de pedido
function criarPedido() {
  const container = document.getElementById("pedidosContainer");
  const indice = document.querySelectorAll(".pedido-individual").length + 1;

  const div = document.createElement("div");
  div.className = "pedido-individual";

  div.innerHTML = `
    <h4>Pedido ${indice}</h4>
    <label>Nome do Cliente: <input type="text" class="nomeCliente"></label>
    <label>Endere√ßo: <input type="text" class="enderecoCliente"></label>

    <h5>Marmitas</h5>
    <select class="tipoMarmita">
      ${cardapio.marmitas.map(m => 
        `<option value="${m.nome}" data-preco="${m.preco}" data-carnes="${m.qtdCarnes}">
           ${m.nome} - R$${m.preco}
         </option>`).join("")}
    </select>

    <h5>Carnes</h5>
    <ul class="listaCarnes">
      ${cardapio.carnes.map(c => 
        `<li><div class="checkbox-fake"></div><span>${c}</span></li>`).join("")}
    </ul>

    <h5>Acompanhamentos</h5>
    <ul class="listaAcomp">
      ${cardapio.acompanhamentos.map(a => 
        `<li><div class="checkbox-fake"></div><span>${a}</span></li>`).join("")}
    </ul>

    <h5>Refrigerantes</h5>
    <ul class="listaRefri">
      ${cardapio.refrigerantes.map(r => 
        `<li><input type="checkbox" class="refriCheck" data-preco="${r.preco}"> ${r.nome} - R$${r.preco}</li>`).join("")}
    </ul>

    <label>Adicionais: <input type="text" class="adicionais"></label>
    <label>Pagamento:
      <select class="pagamento">
        <option>Pix</option>
        <option>Dinheiro</option>
        <option>Cart√£o</option>
      </select>
    </label>
  `;

  container.appendChild(div);

  // ‚ö° Desativa acompanhamentos se for Por√ß√£o (somente carne)
  const selectMarmita = div.querySelector(".tipoMarmita");
  const listaAcomp = div.querySelector(".listaAcomp");
  selectMarmita.addEventListener("change", () => {
    const tipo = selectMarmita.value.toLowerCase();
    if (tipo.includes("por√ß√£o")) {
      listaAcomp.style.opacity = "0.5";
      listaAcomp.querySelectorAll("li").forEach(li => li.style.pointerEvents = "none");
    } else {
      listaAcomp.style.opacity = "1";
      listaAcomp.querySelectorAll("li").forEach(li => li.style.pointerEvents = "auto");
    }
  });
}

// Bot√£o para adicionar mais pedidos
document.getElementById("adicionarPedido").addEventListener("click", criarPedido);

// Carrega o card√°pio e cria o primeiro pedido
carregarCardapio().then(() => {
  if (cardapio) criarPedido();
});



  const container = document.createElement("div");
  container.classList.add("pedido-individual");
  container.dataset.index = index;

  container.innerHTML = `
    <h4>Pedido da Pessoa ${index+1}</h4>
    <label>Nome:</label>
    <input type="text" class="nomeCliente" placeholder="Nome do cliente">
    <label>Endere√ßo:</label>
    <input type="text" class="enderecoCliente" placeholder="Endere√ßo de entrega">

    <div class="marmita-options"><h4>üç± Tipo de Marmita</h4></div>
    <h4>üçñ Carnes</h4><ul class="carnes"></ul>
    <h4>ü•ó Acompanhamentos</h4><ul class="acompanhamentos"></ul>
    <h4>ü•§ Refrigerantes</h4><ul class="refrigerantes"></ul>
    <h4>Adicionais:</h4>
    <input type="text" class="adicionais" placeholder="Digite adicionais">
    <h4>üìç Local de Entrega</h4>
    <select class="localEntrega"></select>
    <h4>üí≥ Formas de Pagamento</h4>
    <ul class="formasPagamentoList"></ul>
  `;

  document.getElementById("pedidosContainer").appendChild(container);

  const marmitaContainer = container.querySelector(".marmita-options");
  let limiteCarnes = 0;
  let carnesSelecionadas = [];
  let refrigerantesSelecionados = [];

  // Marmita
  // Marmita
Object.keys(cardapioFinal.valoresMarmita).forEach((key, index) => {
  const label = document.createElement("label");
  label.innerHTML = `<input type="radio" name="marmita${index}" value="${key}"> Marmita ${key} - R$${cardapioFinal.valoresMarmita[key]},00`;
  label.querySelector("input").addEventListener("change", () => {
    pedidoObj.marmita = key;
    pedidoObj.valorMarmita = cardapioFinal.valoresMarmita[key];

    // Limite de carnes
    if (key.includes("01 Op√ß√£o") || key.toLowerCase().includes("por√ß√£o")) {
      limiteCarnes = 1;

      // Desabilitar acompanhamentos
      container.querySelectorAll(".acompanhamentos li").forEach(li => {
        li.classList.remove("selected");
        li.style.pointerEvents = "none";
        li.style.opacity = "0.5";
      });
      pedidoObj.acompanhamentos = [];
    } else if (key.includes("02 Op√ß√£o")) {
      limiteCarnes = 2;

      // Habilitar acompanhamentos
      container.querySelectorAll(".acompanhamentos li").forEach(li => {
        li.style.pointerEvents = "auto";
        li.style.opacity = "1";
      });
    }

    // Limpar carnes selecionadas
    carnesSelecionadas = [];
    container.querySelectorAll(".carnes li").forEach(li => li.classList.remove("selected"));

    // Limpar refrigerantes selecionados
    refrigerantesSelecionados = [];
    container.querySelectorAll(".refrigerantes li").forEach(li => li.classList.remove("selected"));

    atualizarPedido();
  });
  marmitaContainer.appendChild(label);
});

// Fun√ß√£o criar lista
function criarLista(itens, ulContainer, tipo) {
  ulContainer.innerHTML = "";
  itens.forEach(i => {
    const li = document.createElement("li");
    li.setAttribute("data-item", i);
    li.innerHTML = `<div class="checkbox-fake">X</div><span>${i}</span>`;

    // Marcar como selecionado por padr√£o apenas itens que n√£o s√£o carnes ou refrigerantes
    if (tipo !== "carnes" && tipo !== "refrigerantes") li.classList.add("selected");

    li.addEventListener("click", () => {
      if (tipo === "carnes") {
        if (!li.classList.contains("selected") && carnesSelecionadas.length >= limiteCarnes) return;
      }
      li.classList.toggle("selected");

      const item = li.getAttribute("data-item");

      if (li.classList.contains("selected")) {
        if (tipo === "carnes") carnesSelecionadas.push(item);
        else if (tipo === "acompanhamentos") pedidoObj.acompanhamentos.push(item);
        else if (tipo === "refrigerantes") {
          const preco = parseFloat(item.split('R$')[1]) || 0;
          refrigerantesSelecionados.push({ nome: item, preco });
        }
      } else {
        if (tipo === "carnes") carnesSelecionadas = carnesSelecionadas.filter(x => x !== item);
        else if (tipo === "acompanhamentos") pedidoObj.acompanhamentos = pedidoObj.acompanhamentos.filter(x => x !== item);
        else if (tipo === "refrigerantes") refrigerantesSelecionados = refrigerantesSelecionados.filter(r => r.nome !== item);
      }

      atualizarPedido();
    });

    ulContainer.appendChild(li);
  });
}

  
  // Carnes e acompanhamentos
  const hojeCardapio = cardapioFinal.cardapio[diasSemana[hojeDate.getDay()].toLowerCase()] || { carnes: [], acompanhamentos: [] };
  criarLista(hojeCardapio.carnes, container.querySelector(".carnes"), "carnes");
  criarLista(hojeCardapio.acompanhamentos, container.querySelector(".acompanhamentos"), "acompanhamentos");

  // Refrigerantes
  const refItems = Object.entries(cardapioFinal.refrigerantes).flatMap(([tipo,list])=>list.map(r=>`${tipo} - ${r.nome} R$${r.preco}`));
  criarLista(refItems, container.querySelector(".refrigerantes"), "refrigerantes");

  // Locais de entrega
  const localEl = container.querySelector(".localEntrega");
  cardapioFinal.locaisEntrega.forEach((loc,i)=>{
    const opt = document.createElement("option");
    opt.value = loc.nome;
    opt.dataset.taxa = loc.taxa;
    opt.textContent = `${loc.nome} - R$${loc.taxa.toFixed(2)}`;
    if(i===0) pedidoObj.taxaEntrega = loc.taxa;
    localEl.appendChild(opt);
  });
  localEl.addEventListener("change", ()=>{
    pedidoObj.taxaEntrega = parseFloat(localEl.selectedOptions[0].dataset.taxa);
    atualizarPedido();
  });

  // Formas de pagamento
  const formasEl = container.querySelector(".formasPagamentoList");
  cardapioFinal.formasPagamento.forEach(f=>{
    const li = document.createElement("li");
    li.innerHTML = `<div class="checkbox-fake">X</div><span>${f}</span>`;
    li.addEventListener("click", ()=>{
      formasEl.querySelectorAll("li").forEach(l=>l.classList.remove("selected"));
      li.classList.add("selected");
      pedidoObj.pagamento = f;
      atualizarPedido();
    });
    formasEl.appendChild(li);
  });

  // Inputs nome, endere√ßo, adicionais
  container.querySelector(".nomeCliente").addEventListener("input", e=>{
    pedidoObj.nome = e.target.value;
    atualizarPedido();
  });
  container.querySelector(".enderecoCliente").addEventListener("input", e=>{
    pedidoObj.endereco = e.target.value;
    atualizarPedido();
  });
  container.querySelector(".adicionais").addEventListener("input", e=>{
    pedidoObj.adicionais = e.target.value;
    atualizarPedido();
  });

  function atualizarPedido(){
    pedidoObj.carnes = carnesSelecionadas;
    pedidoObj.refrigerantes = refrigerantesSelecionados;

    let totalRef = refrigerantesSelecionados.reduce((sum,r)=>sum+r.preco,0);
    pedidoObj.total = (pedidoObj.valorMarmita || 0) + totalRef + (pedidoObj.taxaEntrega || 0);

    // Atualizar lista de pedidos
    const itensEl = document.getElementById("itensPedido");
    if(pedidos.length===0){ itensEl.innerHTML = "<li>Nenhum pedido adicionado</li>"; return; }
    let html = "";
    pedidos.forEach((p,i)=>{
      html += `<li><strong>Pedido ${i+1} - ${p.nome || "Cliente"}:</strong><ul>`;
      if(p.marmita) html += `<li>üç± Marmita ${p.marmita} - R$${p.valorMarmita}</li>`;
      if(p.carnes) p.carnes.forEach(c=>html += `<li>üçñ ${c}</li>`);
      if(p.acompanhamentos) p.acompanhamentos.forEach(a=>html += `<li>ü•ó ${a}</li>`);
      if(p.refrigerantes) p.refrigerantes.forEach(r=>html += `<li>ü•§ ${r.nome} - R$${r.preco}</li>`);
      if(p.adicionais) html += `<li>üìù ${p.adicionais}</li>`;
      if(p.pagamento) html += `<li>üí≥ Pagamento: ${p.pagamento}</li>`;
      html += `<li>üèçÔ∏è Taxa de entrega: R$${(p.taxaEntrega||0).toFixed(2)}</li>`;
      html += `<li>üí∞ Subtotal: R$${(p.total||0).toFixed(2)}</li>`;
      html += `</ul></li>`;
    });
    // Total geral
    const totalGeral = pedidos.reduce((sum,p)=>sum+(p.total||0),0);
    html += `<li><strong>Total Geral: R$${totalGeral.toFixed(2)}</strong></li>`;
    itensEl.innerHTML = html;
  }

  atualizarPedido();
}

// Adicionar pedido
document.getElementById("adicionarPedido").addEventListener("click", ()=>{
  if(!cardapioFinal) { alert("Aguarde o carregamento do card√°pio..."); return; }
  criarPedido();
});


// Enviar via WhatsApp
document.getElementById("enviarWhats").addEventListener("click", ()=>{
  const agora = new Date();
  const horas = agora.getHours();
  const minutos = agora.getMinutes();
  const agoraMinutos = horas*60+minutos;
  const [horaAbertura, minAbertura] = cardapioFinal.horarioFuncionamento.abertura.split(":").map(Number);
  const [horaFechamento, minFechamento] = cardapioFinal.horarioFuncionamento.fechamento.split(":").map(Number);
  const aberturaMinutos = horaAbertura*60+minAbertura;
  const fechamentoMinutos = horaFechamento*60+minFechamento;

  if(agoraMinutos<aberturaMinutos || agoraMinutos>fechamentoMinutos){
    alert(`Pedidos s√≥ podem ser feitos entre ${cardapioFinal.horarioFuncionamento.abertura} e ${cardapioFinal.horarioFuncionamento.fechamento}.`);
    return;
  }

  if(pedidos.length===0){ alert("Nenhum pedido adicionado."); return; }

  // Montar mensagem profissional
  let msg = `*Restaurante Colinas*\nPedidos de ${dia}/${mes}/${ano}\n\n`;
  pedidos.forEach((p,i)=>{
    msg += `*Pedido ${i+1} ‚Äì ${p.nome || "Cliente"}*\n`;
    if(p.marmita) msg += `üç± Marmita: ${p.marmita} ‚Äì R$${(p.valorMarmita || 0).toFixed(2)}\n`;
    if(p.carnes && p.carnes.length>0) msg += `üçñ Carnes: ${p.carnes.join(", ")}\n`;
    if(p.acompanhamentos && p.acompanhamentos.length>0) msg += `ü•ó Acompanhamentos: ${p.acompanhamentos.join(", ")}\n`;
    if(p.refrigerantes && p.refrigerantes.length>0) {
      p.refrigerantes.forEach(r=>{
        msg += `ü•§ Refrigerante: ${r.nome} ‚Äì R$${r.preco.toFixed(2)}\n`;
      });
    }
    if(p.adicionais) msg += `üìù Adicionais: ${p.adicionais}\n`;
    if(p.pagamento) msg += `üí≥ Pagamento: ${p.pagamento}\n`;
    msg += `üèçÔ∏è Taxa de entrega: R$${(p.taxaEntrega||0).toFixed(2)}\n`;
    msg += `üí∞ Subtotal: R$${(p.total||0).toFixed(2)}\n\n`;
  });

  const totalGeral = pedidos.reduce((sum,p)=>sum+(p.total||0),0);
  msg += `*üí∏ TOTAL GERAL: R$${totalGeral.toFixed(2)}*`;

  // Abrir WhatsApp
  window.open(`https://wa.me/+556192633504?text=${encodeURIComponent(msg)}`, "_blank");
});


// Gerar PDF
const { jsPDF } = window.jspdf;

function gerarCupom(pedidos) {
  const dia = new Date().getDate().toString().padStart(2,"0");
  const mes = (new Date().getMonth()+1).toString().padStart(2,"0");
  const ano = new Date().getFullYear();

  // Criar PDF no tamanho de cupom 58mm (~165px) de largura
  const doc = new jsPDF({
    unit: "mm",
    format: [58, 500], // altura grande, ajustamos no final
  });

  doc.setFont("courier", "normal");
  doc.setFontSize(9);

  // Cabe√ßalho
  doc.setFont("courier", "bold");
  doc.setFontSize(11);
  doc.text("Restaurante Colinas", 29, 8, { align: "center" });
  doc.setFontSize(9);
  doc.setFont("courier", "normal");
  doc.text(`Pedidos de ${dia}/${mes}/${ano}`, 29, 14, { align: "center" });
  doc.text("------------------------------------------", 29, 18, { align: "center" });

  let y = 24;

  pedidos.forEach((p, i) => {
    doc.setFont("courier", "bold");
    doc.text(`PEDIDO ${i + 1} - ${p.nome || "Cliente"}`, 2, y);
    y += 4;

    doc.setFont("courier", "normal");
    if (p.marmita) {
      doc.text(`üç± Marmita: ${p.marmita}`, 2, y);
      y += 4;
    }
    if (p.carnes?.length) {
      doc.text(`üçñ Carnes: ${p.carnes.join(", ")}`, 2, y);
      y += 4;
    }
    if (p.acompanhamentos?.length) {
      doc.text(`ü•ó Acomp: ${p.acompanhamentos.join(", ")}`, 2, y);
      y += 4;
    }
    if (p.refrigerantes?.length) {
      p.refrigerantes.forEach(r => {
        doc.text(`ü•§ ${r.nome} - R$${r.preco.toFixed(2)}`, 2, y);
        y += 4;
      });
    }
    if (p.adicionais) {
      doc.text(`üìù Adic: ${p.adicionais}`, 2, y);
      y += 4;
    }
    if (p.pagamento) {
      doc.text(`üí≥ Pagamento: ${p.pagamento}`, 2, y);
      y += 4;
    }

    doc.text(`üèçÔ∏è Entrega: R$${(p.taxaEntrega || 0).toFixed(2)}`, 2, y);
    y += 4;
    doc.text(`üí∞ Subtotal: R$${(p.total || 0).toFixed(2)}`, 2, y);
    y += 6;

    doc.text("------------------------------------------", 29, y, { align: "center" });
    y += 6;

    if (y > 260) {
      doc.addPage();
      y = 10;
    }
  });

  const totalGeral = pedidos.reduce((s, p) => s + (p.total || 0), 0);
  doc.setFont("courier", "bold");
  doc.setFontSize(10);
  doc.text(`TOTAL GERAL: R$${totalGeral.toFixed(2)}`, 29, y, { align: "center" });

  doc.save(`Pedidos_${dia}${mes}${ano}.pdf`);
}


});

</script>
</body>
</html>




