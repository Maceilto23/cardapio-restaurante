<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card√°pio Interativo</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 10px; }
.cardapio { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); max-width: 500px; width: 100%; margin-bottom: 20px; }
.logo-container { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px; }
.logo-container img { height: 60px; margin-right: 15px; border-radius: 8px; }
.titulo-container h1 { font-size: 1.5rem; color: #007BFF; margin-bottom: 5px; }
.titulo-container h2 { font-size: 1.1rem; color: #555; font-weight: normal; }
.titulo-container h3 { font-size: 1rem; margin-bottom: 10px; color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; cursor: pointer; display: flex; align-items: center; padding: 6px 10px; border-radius: 8px; transition: background 0.2s; }
li:hover { background: #f0f0f0; }
.checkbox-fake { width: 22px; height: 22px; border: 2px solid #007BFF; display: flex; align-items: center; justify-content: center; margin-right: 10px; border-radius: 4px; font-weight: bold; color: #fff; background: #007BFF; opacity: 0; transition: opacity 0.2s, transform 0.2s; flex-shrink: 0; }
li.selected .checkbox-fake { opacity: 1; transform: scale(1.1); }
li span { flex: 1; }
#adicionais, input[type="text"], input[type="number"], select { width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
#enviarWhats, #gerarMarmitas { margin-top: 12px; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }
#gerarMarmitas { background: #007BFF; color: #fff; }
#enviarWhats { background: #25D366; color: #fff; }
.marmita-icons { display: flex; flex-wrap: wrap; margin-top: 10px; gap: 8px; }
.marmita-icon { width: 50px; height: 50px; background: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; border: 2px solid #ccc; transition: border 0.2s; }
.marmita-icon.selected { border-color: #007BFF; background: #e0f0ff; }
.marmita-choose { display: none; margin-top: 10px; padding: 10px; border: 1px solid #007BFF; border-radius: 8px; background: #f9f9f9; }
.marmita-options label { display:block; margin-bottom:6px; cursor:pointer; }
.marmita-options input { margin-right: 8px; }
@media (max-width: 600px) { 
  .logo-container { flex-direction: column; align-items: center; text-align: center; } 
  .logo-container img { margin-right: 0; margin-bottom: 8px; height: 50px; } 
  .titulo-container h1 { font-size: 1.3rem; } 
  .titulo-container h2 { font-size: 1rem; } 
  #enviarWhats, #gerarMarmitas { font-size: 0.95rem; } 
}
</style>
</head>
<body>

<div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>üçΩÔ∏è Card√°pio de Hoje ‚Äì <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Hor√°rio: --:-- - --:--</h3>
    </div>
  </div>

 <label for="quantidadeMarmitas">Quantidade de Marmitas:</label>
<input type="number" id="quantidadeMarmitas" min="1" max="20" value="1">
<button id="gerarMarmitas">Gerar Marmitas</button>

<div class="marmita-icons" id="marmitaIcons"></div>

<div class="marmita-choose" id="marmitaChoose">
  <h3>Escolha os itens da Marmita</h3>
  <div class="marmita-options"></div>
  <h3>üçñ Carnes</h3>
  <ul id="carnes"></ul>
  <h3>ü•ó Acompanhamentos</h3>
  <ul id="acompanhamentos"></ul>
</div>

  <h3>ü•§ Refrigerantes</h3>
  <ul id="refrigerantes"></ul>

  <h3>Adicionais:</h3>
  <input type="text" id="adicionais" placeholder="Digite adicionais">

  <div class="cliente-info">
    <label for="nomeCliente">Nome do Cliente:</label>
    <input type="text" id="nomeCliente" placeholder="Digite seu nome">
    <label for="enderecoCliente">Endere√ßo:</label>
    <input type="text" id="enderecoCliente" placeholder="Digite o endere√ßo de entrega">
  </div>

  <h3>üìç Local de Entrega</h3>
  <select id="localEntrega"></select>

  <h3>üí≥ Formas de Pagamento</h3>
  <ul id="formasPagamentoList"></ul>

  <button id="enviarWhats">Enviar via WhatsApp</button>

  <h3>üìã Pedido Selecionado</h3>
  <ul id="itensPedido"><li>Nenhum item selecionado</li></ul>
</div>

<script>
const diasSemana = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
const hojeDate = new Date();
document.getElementById("diaSemana").innerText = diasSemana[hojeDate.getDay()];
const dia = String(hojeDate.getDate()).padStart(2,'0');
const mes = String(hojeDate.getMonth()+1).padStart(2,'0');
const ano = hojeDate.getFullYear();
document.getElementById("dataHoje").innerText = `${dia}/${mes}/${ano}`;

// ======================
// Carregar card√°pio JSON
// ======================
fetch('cardapio.json?t=' + new Date().getTime())
  .then(response => response.json())
  .then(cardapioFinal => {
    
    document.getElementById("horarioFuncionamento").textContent = 
      `Hor√°rio: ${cardapioFinal.horarioFuncionamento.abertura} - ${cardapioFinal.horarioFuncionamento.fechamento}`;

    let marmitaAtual = 0;
    let marmitasSelecionadas = [];
    let refrigerantesSelecionados = [];
    let taxaEntrega = cardapioFinal.locaisEntrega[0].taxa;
    let pagamentoSelecionado = "";

    const marmitaIconsEl = document.getElementById("marmitaIcons");
    const marmitaChoose = document.getElementById("marmitaChoose");

    // --------------------
    // Gerar Marmitas
    // --------------------
    document.getElementById("gerarMarmitas").addEventListener("click", () => {
      const qtd = parseInt(document.getElementById("quantidadeMarmitas").value) || 1;
      marmitaIconsEl.innerHTML = "";
      // Adiciona quantidade inicial 1
      marmitasSelecionadas = Array(qtd).fill({marmita:"", carnes:[], acompanhamentos:[], quantidade:1, tipoCarne:1, porcao: false});
      
      for(let i=0;i<qtd;i++){
        const div = document.createElement("div");
        div.classList.add("marmita-icon");
        div.textContent = i+1;
        div.addEventListener("click", ()=> {
          marmitaAtual = i;
          marmitaChoose.style.display = "block";
          selecionarItensMarmita(i);
          document.querySelectorAll(".marmita-icon").forEach(ic=>ic.classList.remove("selected"));
          div.classList.add("selected");
        });
        marmitaIconsEl.appendChild(div);
      }
    });

    // --------------------
    // Sele√ß√£o Marmita
    // --------------------
    function selecionarItensMarmita(index){
      const tiposMarmita = Object.keys(cardapioFinal.valoresMarmita);
      const optionsDiv = document.querySelector(".marmita-options");
      optionsDiv.innerHTML = "";
      
      tiposMarmita.forEach(t=>{
        const label = document.createElement("label");
        label.innerHTML = `<input type="radio" name="marmitaSel" value="${t}" ${marmitasSelecionadas[index].marmita===t?"checked":""}> Marmita ${t} - R$${cardapioFinal.valoresMarmita[t]}`;
        label.querySelector("input").addEventListener("change", ()=>{
          marmitasSelecionadas[index].marmita = t;
          // Determinar tipo de carne baseado no nome da marmita (ex: "01 Carne" = 1)
          marmitasSelecionadas[index].tipoCarne = t.includes("01") ? 1 : (t.includes("02") ? 2 : 1);
          marmitasSelecionadas[index].porcao = t.toLowerCase().includes("por√ß√£o");
          marmitasSelecionadas[index].carnes = [];
          marmitasSelecionadas[index].acompanhamentos = [];
          atualizarPedido();
          selecionarItensMarmita(index); // Re-renderiza listas
        });
        optionsDiv.appendChild(label);
      });

      // Campo para quantidade
      const quantidadeDiv = document.getElementById("quantidadeAtualMarmita");
      quantidadeDiv.innerHTML = `Quantidade: <input type="number" min="1" value="${marmitasSelecionadas[index].quantidade}" style="width:50px;">`;
      quantidadeDiv.querySelector("input").addEventListener("change", (e)=>{
        let val = parseInt(e.target.value);
        if(isNaN(val) || val < 1) val = 1;
        marmitasSelecionadas[index].quantidade = val;
        e.target.value = val;
        atualizarPedido();
      });

      // Carnes
      criarLista(cardapioFinal.cardapio["sexta-feira"].carnes, document.getElementById("carnes"), "carnes", index, marmitasSelecionadas[index].tipoCarne, marmitasSelecionadas[index].porcao);
      // Acompanhamentos
      criarLista(cardapioFinal.cardapio["sexta-feira"].acompanhamentos, document.getElementById("acompanhamentos"), "acompanhamentos", index, marmitasSelecionadas[index].tipoCarne, marmitasSelecionadas[index].porcao);
    }

    // --------------------
    // Criar listas clic√°veis
    // --------------------
    function criarLista(itens, container, tipo, index, maxCarne, porcao){
      container.innerHTML = "";
      itens.forEach(item=>{
        const li = document.createElement("li");
        li.textContent = item;
        if(marmitasSelecionadas[index][tipo].includes(item)) li.classList.add("selected");

        // Desabilitar acompanhamentos se por√ß√£o de carne
        if(tipo==="acompanhamentos" && porcao){
          li.classList.add("disabled");
        }

        li.addEventListener("click", ()=>{
          if(li.classList.contains("disabled")) return;
          if(tipo==="carnes" && !li.classList.contains("selected") && marmitasSelecionadas[index][tipo].length>=maxCarne) return;
          li.classList.toggle("selected");
          if(li.classList.contains("selected")){
            marmitasSelecionadas[index][tipo].push(item);
          } else {
            marmitasSelecionadas[index][tipo] = marmitasSelecionadas[index][tipo].filter(x=>x!==item);
          }
          atualizarPedido();
        });
        container.appendChild(li);
      });
    }

    // --------------------
    // Atualizar pedido
    // --------------------
    function atualizarPedido(){
      const adicionais = document.getElementById("adicionais").value;
      let totalMarmitas = marmitasSelecionadas.reduce((sum,m)=>sum+(cardapioFinal.valoresMarmita[m.marmita]||0)*m.quantidade,0);
      let totalRef = refrigerantesSelecionados.reduce((sum,r)=>sum+r.preco,0);
      const total = totalMarmitas + totalRef + taxaEntrega;

      const itensEl = document.getElementById("itensPedido");
      itensEl.innerHTML = "";
      marmitasSelecionadas.forEach((m,i)=>{
        itensEl.innerHTML += `<li>üç± Marmita ${i+1} (${m.quantidade}x): ${m.marmita} - Carnes: ${m.carnes.join(", ")} - Acomp.: ${m.acompanhamentos.join(", ")}</li>`;
      });
      refrigerantesSelecionados.forEach(r=>itensEl.innerHTML += `<li>ü•§ ${r.tipo} - ${r.nome} R$${r.preco}</li>`);
      if(adicionais) itensEl.innerHTML += `<li>üìù ${adicionais}</li>`;
      if(pagamentoSelecionado) itensEl.innerHTML += `<li>üí≥ Pagamento: ${pagamentoSelecionado}</li>`;
      itensEl.innerHTML += `<li>üèçÔ∏è Taxa de entrega: R$${taxaEntrega.toFixed(2)}</li>`;
      itensEl.innerHTML += `<li>üí∞ Total: R$${total.toFixed(2)}</li>`;
    }

    // --------------------
    // WhatsApp
    // --------------------
    document.getElementById("enviarWhats").addEventListener("click", ()=>{
      const nome = document.getElementById("nomeCliente").value || "Cliente";
      const endereco = document.getElementById("enderecoCliente").value || "N√£o informado";
      const local = document.getElementById("localEntrega").value;
      const adicionais = document.getElementById("adicionais").value;
      let msg = `Ol√°! Pedido de ${nome}\nEndere√ßo: ${endereco}\nLocal: ${local}\n\n`;
      marmitasSelecionadas.forEach((m,i)=>{
        msg += `üç± Marmita ${i+1} (${m.quantidade}x): ${m.marmita} - Carnes: ${m.carnes.join(", ")} - Acomp.: ${m.acompanhamentos.join(", ")}\n`;
      });
      refrigerantesSelecionados.forEach(r=>msg += `ü•§ ${r.tipo} - ${r.nome} R$${r.preco}\n`);
      if(adicionais) msg += `üìù ${adicionais}\n`;
      msg += `üí≥ Pagamento: ${pagamentoSelecionado || "N√£o definido"}\n`;
      msg += `üèçÔ∏è Taxa de entrega: R$${taxaEntrega.toFixed(2)}`;
      const total = marmitasSelecionadas.reduce((sum,m)=>sum+(cardapioFinal.valoresMarmita[m.marmita]||0)*m.quantidade,0) + refrigerantesSelecionados.reduce((sum,r)=>sum+r.preco,0) + taxaEntrega;
      msg += `\nüí∞ Total: R$${total.toFixed(2)}`;
      window.open(`https://wa.me/+556192633504?text=${encodeURIComponent(msg)}`,"_blank");
    });

  })
  .catch(err => console.error("Erro ao carregar card√°pio.json:", err));
</script>
