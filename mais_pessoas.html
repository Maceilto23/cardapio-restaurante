<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card√°pio Interativo</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 10px; }
.cardapio { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); max-width: 500px; width: 100%; margin-bottom: 20px; }
.logo-container { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px; }
.logo-container img { height: 60px; margin-right: 15px; border-radius: 8px; }
.titulo-container h1 { font-size: 1.5rem; color: #007BFF; margin-bottom: 5px; }
.titulo-container h2 { font-size: 1.1rem; color: #555; font-weight: normal; }
.titulo-container h3 { font-size: 1rem; margin-bottom: 10px; color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; cursor: pointer; display: flex; align-items: center; padding: 6px 10px; border-radius: 8px; transition: background 0.2s; }
li:hover { background: #f0f0f0; }
.checkbox-fake { width: 22px; height: 22px; border: 2px solid #007BFF; display: flex; align-items: center; justify-content: center; margin-right: 10px; border-radius: 4px; font-weight: bold; color: #fff; background: #007BFF; opacity: 0; transition: opacity 0.2s, transform 0.2s; flex-shrink: 0; }
li.selected .checkbox-fake { opacity: 1; transform: scale(1.1); }
li span { flex: 1; }
#adicionais, input[type="text"], select, textarea { width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
#taxaEntregaInfo{ margin:12px 0; background:#e8f0fe; border:1px solid #007BFF; color:#007BFF; font-weight:bold; text-align:center; padding:8px; border-radius:8px; }
#enviarWhats { margin-top: 12px; padding: 10px; background: #25D366; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }
label { display: block; margin-bottom: 6px; cursor: pointer; }
.marmita-options label { display: block; margin-bottom: 8px; cursor: pointer; }
.marmita-options input { margin-right: 8px; }
#adicionarPedido { margin: 10px 0; padding: 8px; width: 100%; border-radius: 8px; border: 1px solid #007BFF; background: #007BFF; color: #fff; cursor: pointer; font-weight: bold; }
.pedido-individual { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; background: #f9f9f9; }
.pedido-individual h4 { margin-bottom: 5px; }
@media (max-width: 600px) { 
  .logo-container { flex-direction: column; align-items: center; text-align: center; } 
  .logo-container img { margin-right: 0; margin-bottom: 8px; height: 50px; } 
  .titulo-container h1 { font-size: 1.3rem; } 
  .titulo-container h2 { font-size: 1rem; } 
  #enviarWhats, #adicionarPedido { font-size: 0.95rem; } 
}
</style>
</head>
<body>

<div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>üçΩÔ∏è Card√°pio de Hoje ‚Äì <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Hor√°rio: --:-- - --:--</h3>
    </div>
  </div>

  <label for="endereco">üìç Endere√ßo de Entrega (√∫nico para todos os pedidos)</label>
  <input type="text" id="endereco" placeholder="Digite o endere√ßo de entrega">

  <label>Local de Entrega:</label>
  <select id="localEntrega"></select>

  <div id="taxaEntregaInfo">üèçÔ∏è Taxa de entrega: R$ 0,00</div>

  <label for="pagamento">üí≥ Forma de Pagamento (√∫nica para todos)</label>
  <select id="pagamento">
    <option value="" disabled selected>Carregando op√ß√µes...</option>
  </select>

  <button id="adicionarPedido">‚ûï Adicionar Pedido de Outra Pessoa</button>

  <div id="pedidosContainer"></div>

  <h3>üìã Pedidos Selecionados</h3>
  <ul id="itensPedido">
    <li>Nenhum pedido adicionado</li>
  </ul>

  <button id="enviarWhats">üì≤ Enviar para WhatsApp</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// ========== DATA ==========
const diasSemana = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
const hojeDate = new Date();
document.getElementById("diaSemana").innerText = diasSemana[hojeDate.getDay()];
const dia = String(hojeDate.getDate()).padStart(2,'0');
const mes = String(hojeDate.getMonth()+1).padStart(2,'0');
const ano = hojeDate.getFullYear();
document.getElementById("dataHoje").innerText = `${dia}/${mes}/${ano}`;

// ========== VARI√ÅVEIS ==========
let pedidos = [];
let cardapioFinal = null;

// ========== CARREGAR CARD√ÅPIO ==========
fetch('cardapio.json?t=' + new Date().getTime())
.then(res => res.json())
.then(data => {
  cardapioFinal = data;
  document.getElementById("horarioFuncionamento").textContent = 
    `Hor√°rio: ${data.horarioFuncionamento.abertura} - ${data.horarioFuncionamento.fechamento}`;

  // Locais
  const localSelect = document.getElementById("localEntrega");
  localSelect.innerHTML = '<option value="" disabled selected>Selecione o local</option>';
  data.locaisEntrega.forEach((loc) => {
    const opt = document.createElement("option");
    opt.value = loc.nome;
    opt.dataset.taxa = loc.taxa;
    opt.textContent = `${loc.nome} - R$${loc.taxa.toFixed(2)}`;
    localSelect.appendChild(opt);
  });

  // Pagamento
  const pagamentoSelect = document.getElementById("pagamento");
  pagamentoSelect.innerHTML = '';
  if(data.formasPagamento && Array.isArray(data.formasPagamento) && data.formasPagamento.length){
    const defaultOpt = document.createElement('option');
    defaultOpt.value = '';
    defaultOpt.textContent = 'Selecione a forma de pagamento';
    defaultOpt.disabled = true; defaultOpt.selected = true;
    pagamentoSelect.appendChild(defaultOpt);
    data.formasPagamento.forEach(fp=>{
      const o = document.createElement('option');
      o.value = fp; o.textContent = fp;
      pagamentoSelect.appendChild(o);
    });
  } else {
    pagamentoSelect.innerHTML = `
      <option value="" disabled selected>Selecione a forma de pagamento</option>
      <option value="Dinheiro">Dinheiro</option>
      <option value="Pix">Pix</option>
      <option value="Cart√£o">Cart√£o</option>
    `;
  }

  // Atualiza taxa quando muda local
  localSelect.addEventListener('change', ()=> {
    const taxa = parseFloat(localSelect.selectedOptions[0]?.dataset.taxa || 0);
    document.getElementById('taxaEntregaInfo').textContent = `üèçÔ∏è Taxa de entrega: R$ ${taxa.toFixed(2)}`;
    atualizarPedido();
  });
})
.catch(err=>{ console.error('Erro ao carregar cardapio.json', err); });

// ========== ADICIONAR PEDIDO ==========
document.getElementById("adicionarPedido").addEventListener("click", criarPedido);

function criarPedido(){
  if(!cardapioFinal) return alert("Aguarde o carregamento do card√°pio...");
  const index = pedidos.length;
  const pedidoObj = { nome:"", marmita:"", carnes:[], acompanhamentos:[], refrigerantes:[], adicionais:"", valorMarmita:0};
  pedidos.push(pedidoObj);

  const container = document.createElement("div");
  container.classList.add("pedido-individual");
  container.dataset.index = index;

  container.innerHTML = `
    <h4>Pedido da Pessoa ${index + 1}</h4>
    <label>üë§ Nome do Cliente:</label>
    <input type="text" class="nomeCliente" placeholder="Nome do cliente">
    <div class="marmita-options"><h4>üç± Tipo de Marmita</h4></div>
    <h4>üçñ Carnes</h4><ul class="carnes"></ul>
    <h4>ü•ó Acompanhamentos</h4><ul class="acompanhamentos"></ul>
    <h4>ü•§ Refrigerantes</h4><ul class="refrigerantes"></ul>
    <h4>Adicionais:</h4>
    <input type="text" class="adicionais" placeholder="Digite adicionais">
  `;

  document.getElementById("pedidosContainer").appendChild(container);

  // ========== CONFIGURAR MARMITA ==========
  let limiteCarnes = 0;
  const marmitaContainer = container.querySelector(".marmita-options");

  const hojeCardapio = cardapioFinal.cardapio[diasSemana[hojeDate.getDay()].toLowerCase()] || { carnes: [], acompanhamentos: [] };
  const acompanhamentosPadrao = {
    "01": hojeCardapio.acompanhamentos,
    "02": hojeCardapio.acompanhamentos
  };

  Object.keys(cardapioFinal.valoresMarmita).forEach(key=>{
    const label = document.createElement("label");
    label.innerHTML = `<input type="radio" name="marmita${index}" value="${key}"> Marmita ${key} - R$${cardapioFinal.valoresMarmita[key]},00`;
    label.querySelector("input").addEventListener("change", ()=>{
      pedidoObj.marmita = key;
      pedidoObj.valorMarmita = cardapioFinal.valoresMarmita[key];

      limiteCarnes = key.includes("01") ? 1 : key.includes("02") ? 2 : 0;

      const acompLis = container.querySelectorAll(".acompanhamentos li");
      if(key.toLowerCase().includes("por√ß√£o")) {
        acompLis.forEach(li=>{
          li.classList.remove("selected");
          li.style.pointerEvents = "none";
        });
        pedidoObj.acompanhamentos = [];
      } else {
        acompLis.forEach(li=>{
          li.classList.toggle("selected", acompanhamentosPadrao[key]?.includes(li.dataset.item));
          li.style.pointerEvents = "auto";
        });
        pedidoObj.acompanhamentos = Array.from(acompLis).filter(li=>li.classList.contains("selected")).map(li=>li.dataset.item);
      }

      container.querySelectorAll(".carnes li").forEach(li=>li.classList.remove("selected"));
      pedidoObj.carnes = [];
      atualizarPedido();
    });
    marmitaContainer.appendChild(label);
  });

  // ========== FUN√á√ÉO AUXILIAR PARA LISTAS ==========
  function criarLista(itens, ulContainer, tipo, unico=false){
    ulContainer.innerHTML="";
    itens.forEach(i=>{
      const li = document.createElement("li");
      li.setAttribute("data-item", i);
      li.innerHTML = `<div class="checkbox-fake">‚úî</div><span>${i}</span>`;
      if(tipo==='acompanhamentos') li.style.pointerEvents='none';
      li.addEventListener("click", ()=>{
        const selecionados = Array.from(ulContainer.querySelectorAll("li.selected"));
        if(tipo==="carnes" && !li.classList.contains("selected") && selecionados.length>=limiteCarnes) return;
        if(unico) ulContainer.querySelectorAll("li").forEach(l=>l.classList.remove("selected"));
        li.classList.toggle("selected");
        pedidoObj[tipo] = Array.from(ulContainer.querySelectorAll("li.selected")).map(x=>x.dataset.item);
        atualizarPedido();
      });
      ulContainer.appendChild(li);
    });
  }

  criarLista(hojeCardapio.carnes, container.querySelector(".carnes"), "carnes");
  criarLista(hojeCardapio.acompanhamentos, container.querySelector(".acompanhamentos"), "acompanhamentos");

  // ========== REFRIGERANTES COM QUANTIDADE ==========
  const refrigerantesHoje = [];
  Object.values(cardapioFinal.refrigerantes).forEach(tipo => tipo.forEach(r => refrigerantesHoje.push(`${r.nome} R$${r.preco.toFixed(2)}`)));
  
  function criarListaRefrigerantes(itens, ulContainer){
    ulContainer.innerHTML = "";
    itens.forEach(i => {
      const li = document.createElement("li");
      li.setAttribute("data-item", i);
      const partes = i.split('R$');
      const nomeRef = partes[0].trim();
      const precoRef = parseFloat(partes[1]) || 0;

      li.innerHTML = `
        <span>${nomeRef} - R$${precoRef.toFixed(2)}</span>
        <input type="number" min="0" value="0" style="width:50px; margin-left:10px;" />
      `;
      const inputQt = li.querySelector("input");
      inputQt.addEventListener("input", ()=>{
        const pIndex = parseInt(ulContainer.closest(".pedido-individual").dataset.index);
        const pedidoObj = pedidos[pIndex];

        pedidoObj.refrigerantes = [];
        ulContainer.querySelectorAll("li").forEach(liItem=>{
          const input = liItem.querySelector("input");
          const qt = parseInt(input.value) || 0;
          if(qt>0){
            for(let c=0;c<qt;c++){
              pedidoObj.refrigerantes.push(liItem.dataset.item);
            }
          }
        });
        atualizarPedido();
      });

      ulContainer.appendChild(li);
    });
  }

  criarListaRefrigerantes(refrigerantesHoje, container.querySelector(".refrigerantes"));

  container.querySelector(".nomeCliente").addEventListener("input", e=>{ pedidoObj.nome=e.target.value; atualizarPedido(); });
  container.querySelector(".adicionais").addEventListener("input", e=>{ pedidoObj.adicionais=e.target.value; atualizarPedido(); });

  atualizarPedido();
}

// ========== ATUALIZAR PEDIDO ==========
function atualizarPedido(){
  const itensEl = document.getElementById("itensPedido");
  if(pedidos.length===0){ itensEl.innerHTML="<li>Nenhum pedido adicionado</li>"; return; }

  let html="";
  let totalGeral=0;
  const taxaEntregaGlobal = parseFloat(document.getElementById("localEntrega").selectedOptions[0]?.dataset.taxa || 0);
  const localNome = document.getElementById("localEntrega").value || "-";

  html += `<li>üìç Local de Entrega: ${localNome}</li>`;
  html += `<li>üèçÔ∏è Taxa de entrega √∫nica: R$${taxaEntregaGlobal.toFixed(2)}</li>`;

  pedidos.forEach((p,i)=>{
    html += `<li><strong>Pedido ${i+1} - ${p.nome || "Cliente"}:</strong><ul>`;
    if(p.marmita) html+=`<li>üç± Marmita ${p.marmita} - R$${(p.valorMarmita||0).toFixed(2)}</li>`;
    if(p.carnes) p.carnes.forEach(c=>html+=`<li>üçñ ${c}</li>`);
    if(p.acompanhamentos) p.acompanhamentos.forEach(a=>html+=`<li>ü•ó ${a}</li>`);
    if(p.refrigerantes) p.refrigerantes.forEach(r=>html+=`<li>ü•§ ${r}</li>`);
    if(p.adicionais) html+=`<li>üìù ${p.adicionais}</li>`;

    let totalPedido = p.valorMarmita || 0;
    if(p.refrigerantes && p.refrigerantes.length){
      p.refrigerantes.forEach(r=>{
        const preco = parseFloat(r.split('R$')[1]) || 0;
        totalPedido += preco;
      });
    }
    p.total = totalPedido;
    totalGeral += totalPedido;
    html+=`<li><strong>Subtotal: R$${totalPedido.toFixed(2)}</strong></li>`;
    html+="</ul></li>";
  });

  totalGeral += taxaEntregaGlobal;
  html += `<li><strong>üí∞ Total Geral: R$${totalGeral.toFixed(2)}</strong></li>`;
  itensEl.innerHTML = html;
}

// ENVIAR WHATSAPP E GERAR PDF
document.getElementById("enviarWhats").addEventListener("click", ()=>{
  const endereco = document.getElementById("endereco").value.trim();
  const localNome = document.getElementById("localEntrega").value;
  const pagamentoGlobal = document.getElementById('pagamento').value;
  const taxa = parseFloat(document.getElementById('localEntrega').selectedOptions[0]?.dataset.taxa || 0);

  if(!endereco) return alert("Informe o endere√ßo de entrega.");
  if(!localNome) return alert("Escolha o local de entrega.");
  if(!pagamentoGlobal) return alert("Escolha a forma de pagamento.");
  if(pedidos.length===0) return alert("Nenhum pedido adicionado.");

  let msg = `üçΩÔ∏è *Pedidos do Dia*\nüìç Local: ${localNome}\nüìç Endere√ßo: ${endereco}\nüí≥ Pagamento: ${pagamentoGlobal}\nüèçÔ∏è Taxa de Entrega: R$${taxa.toFixed(2)}\n`;
  let totalGeral = 0;

  pedidos.forEach((p,i)=>{
    msg += `\nüìå Pedido ${i+1} - ${p.nome || "Cliente"}\n`;
    let subtotal = p.valorMarmita || 0;

    if(p.marmita) msg += `üç± Marmita ${p.marmita} - R$${(p.valorMarmita||0).toFixed(2)}\n`;

    if(p.carnes) p.carnes.forEach(c=>msg += `üçñ ${c}\n`);
    if(p.acompanhamentos) p.acompanhamentos.forEach(a=>msg += `ü•ó ${a}\n`);

    // Refrigerantes com quantidade
    if(p.refrigerantes && p.refrigerantes.length){
        const contagemRef = {};
        p.refrigerantes.forEach(r=> contagemRef[r] = (contagemRef[r]||0)+1 );
        Object.keys(contagemRef).forEach(r=>{
          msg += `ü•§ ${r} x${contagemRef[r]}\n`;
          const preco = parseFloat(r.split('R$')[1]) || 0;
          subtotal += preco * contagemRef[r];
        });
    }

    if(p.adicionais) msg += `üìù ${p.adicionais}\n`;

    msg += `Subtotal: R$${subtotal.toFixed(2)}\n`;
    totalGeral += subtotal;
  });

  totalGeral += taxa;
  msg += `\nüí∏ *TOTAL GERAL: R$${totalGeral.toFixed(2)}*`;
  window.open(`https://wa.me/+556192633504?text=${encodeURIComponent(msg)}`, "_blank");

 
// PDF Profissional
// PDF Profissional Organizado
const { jsPDF } = window.jspdf;
const doc = new jsPDF({ orientation:'portrait', unit:'pt', format:[226,1000] });
const t = (texto) => texto.normalize("NFC");
const larguraMax = 206;

// Cabe√ßalho
doc.setFont('helvetica','bold'); 
doc.setFontSize(14); 
doc.text(t('Restaurante Colinas'), 113, 20, {align:'center'});

doc.setFont('helvetica','normal'); 
doc.setFontSize(10); 
doc.text(t(`Pedidos de ${dia}/${mes}/${ano}`), 113, 35, {align:'center'});

let y = 55;
[`Local: ${localNome}`, `Endere√ßo: ${endereco}`, `Pagamento: ${pagamentoGlobal}`, `Taxa de entrega: R$${taxa.toFixed(2)}`].forEach(texto=>{
  const linhas = doc.splitTextToSize(t(texto), larguraMax);
  doc.text(linhas, 10, y);
  y += linhas.length * 10;
});
y += 5;

let totalGeralPDF = 0;

pedidos.forEach((p,i)=>{
  doc.setFont('helvetica','bold'); 
  doc.text(`PEDIDO ${i+1} - ${p.nome||"Cliente"}`, 10, y);
  y += 12;

  let subtotal = p.valorMarmita || 0;

  const campos = [];

  // Marmita
  if(p.marmita) campos.push({titulo:'Marmita:', valor:`${p.marmita} - R$${(p.valorMarmita||0).toFixed(2)}`});

  // Carnes
  if(p.carnes.length) campos.push({titulo:'Carnes:', valor:`${p.carnes.join(", ")}`});

  // Acompanhamentos
  if(p.acompanhamentos.length) campos.push({titulo:'Acompanhamentos:', valor:`${p.acompanhamentos.join(", ")}`});

  // Bebidas
  if(p.refrigerantes.length){
    const contagemRef = {};
    p.refrigerantes.forEach(r=> contagemRef[r] = (contagemRef[r]||0)+1 );
    const bebidasText = Object.keys(contagemRef).map(r=> `${r} x${contagemRef[r]}`).join(", ");
    campos.push({titulo:'Bebidas:', valor:bebidasText});

    Object.keys(contagemRef).forEach(r=>{
      const preco = parseFloat(r.split('R$')[1]) || 0;
      subtotal += preco * contagemRef[r];
    });
  }

  // Observa√ß√£o
  if(p.adicionais) campos.push({titulo:'Observa√ß√£o:', valor:p.adicionais});

  // Renderiza√ß√£o dos campos
  campos.forEach(c=>{
    doc.setFont('helvetica','bold');
    doc.text(c.titulo, 15, y);
    doc.setFont('helvetica','normal');
    const linhasValor = doc.splitTextToSize(t(c.valor), larguraMax - 50);
    doc.text(linhasValor, 70, y);
    y += linhasValor.length*10 + 2;
  });

  doc.setFont('helvetica','bold');
  doc.text(`Subtotal: R$${subtotal.toFixed(2)}`, 15, y);
  y += 12;

  // Linha separadora
  doc.setDrawColor(180);
  doc.setLineWidth(0.5);
  doc.line(10, y, 216, y);
  y += 10;

  totalGeralPDF += subtotal;
});

totalGeralPDF += taxa;

doc.setFont('helvetica','bold');
doc.setFontSize(12);
doc.text(`TOTAL GERAL: R$${totalGeralPDF.toFixed(2)}`, 113, y+5, {align:'center'});

doc.save(`Pedidos_${dia}${mes}${ano}.pdf`);





});

</script>
</body>
</html>







