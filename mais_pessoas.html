<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pedidos - Restaurante Colinas</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; max-width: 400px; margin: auto; }
  label { display:block; margin-top:10px; }
  ul { padding-left: 20px; }
  #itensPedido li { margin-bottom: 4px; }
  .pedido { border:1px solid #ccc; padding:10px; margin:10px 0; border-radius:8px; }
  button { margin-top:10px; padding:8px 12px; }
</style>
</head>
<body>

<h2>📋 Novo Pedido</h2>

<label>📍 Endereço de Entrega</label>
<input type="text" id="endereco" placeholder="Digite o endereço">

<label>🗺️ Local de Entrega</label>
<select id="localEntrega">
  <option value="">Selecione</option>
  <option value="Cidade A" data-taxa="5.00">Cidade A - R$5,00</option>
  <option value="Cidade B" data-taxa="8.00">Cidade B - R$8,00</option>
  <option value="Cidade C" data-taxa="10.00">Cidade C - R$10,00</option>
</select>

<label>💳 Forma de Pagamento</label>
<select id="pagamento">
  <option value="Dinheiro">Dinheiro</option>
  <option value="Pix">Pix</option>
  <option value="Cartão">Cartão</option>
</select>

<hr>

<div class="pedido">
  <label>👤 Nome do Cliente</label>
  <input type="text" id="nomeCliente" placeholder="Nome">

  <label>🍱 Marmita</label>
  <select id="marmita">
    <option value="">Selecione</option>
    <option value="01" data-valor="20.00">Marmita 01 - R$20,00</option>
    <option value="02" data-valor="25.00">Marmita 02 - R$25,00</option>
  </select>

  <label>🍖 Carnes</label>
  <input type="text" id="carnes" placeholder="Separar por vírgula">

  <label>🥗 Acompanhamentos</label>
  <input type="text" id="acompanhamentos" placeholder="Separar por vírgula">

  <label>🥤 Refrigerantes</label>
  <input type="text" id="refrigerantes" placeholder="Separar por vírgula">

  <label>📝 Observações / Adicionais</label>
  <input type="text" id="adicionais">

  <button type="button" id="addPedido">➕ Adicionar Pedido</button>
</div>

<h3>🧾 Itens do Pedido</h3>
<ul id="itensPedido"></ul>

<button id="enviarWhats">📤 Enviar WhatsApp + PDF</button>

<script>
const pedidos = [];

document.getElementById("localEntrega").addEventListener("change", atualizarPedido);

document.getElementById("addPedido").addEventListener("click", ()=>{
  const nome = document.getElementById("nomeCliente").value.trim();
  const marmitaSel = document.getElementById("marmita");
  const marmita = marmitaSel.value;
  const valorMarmita = parseFloat(marmitaSel.selectedOptions[0]?.dataset.valor || 0);
  const carnes = document.getElementById("carnes").value.split(",").map(c=>c.trim()).filter(c=>c);
  let acompanhamentos = document.getElementById("acompanhamentos").value.split(",").map(a=>a.trim()).filter(a=>a);
  const refrigerantes = document.getElementById("refrigerantes").value.split(",").map(r=>r.trim()).filter(r=>r);
  const adicionais = document.getElementById("adicionais").value.trim();

  // Se for Marmita 01, inserir acompanhamentos padrão
  if(marmita === "01" && acompanhamentos.length === 0){
    acompanhamentos = ["Arroz","Feijão","Salada"];
  }

  if(!marmita) return alert("Selecione a marmita.");

  pedidos.push({nome, marmita, valorMarmita, carnes, acompanhamentos, refrigerantes, adicionais});
  document.getElementById("nomeCliente").value = "";
  document.getElementById("marmita").value = "";
  document.getElementById("carnes").value = "";
  document.getElementById("acompanhamentos").value = "";
  document.getElementById("refrigerantes").value = "";
  document.getElementById("adicionais").value = "";

  atualizarPedido();
});

function atualizarPedido(){
  const itensEl = document.getElementById("itensPedido");
  if(pedidos.length===0){ itensEl.innerHTML="<li>Nenhum pedido adicionado</li>"; return; }

  const taxaEntrega = parseFloat(document.getElementById("localEntrega").selectedOptions[0]?.dataset.taxa || 0);
  let totalGeral = taxaEntrega;
  let html = `<li>📍 Local de Entrega: ${document.getElementById("localEntrega").value || "-"}</li>`;
  html += `<li>🏍️ Taxa de entrega única: R$${taxaEntrega.toFixed(2)}</li>`;

  pedidos.forEach((p,i)=>{
    let subtotal = p.valorMarmita||0;
    totalGeral += subtotal;

    html += `<li><strong>Pedido ${i+1} - ${p.nome||"Cliente"}:</strong><ul>`;
    html += `<li>🍱 Marmita ${p.marmita} - R$${p.valorMarmita.toFixed(2)}</li>`;
    if(p.carnes.length) p.carnes.forEach(c=>html+=`<li>🍖 ${c}</li>`);
    if(p.acompanhamentos.length) p.acompanhamentos.forEach(a=>html+=`<li>🥗 ${a}</li>`);
    if(p.refrigerantes.length) p.refrigerantes.forEach(r=>html+=`<li>🥤 ${r}</li>`);
    if(p.adicionais) html+=`<li>📝 ${p.adicionais}</li>`;
    html += `<li><strong>Subtotal: R$${subtotal.toFixed(2)}</strong></li></ul></li>`;
  });

  html+=`<li><strong>💰 TOTAL GERAL: R$${totalGeral.toFixed(2)}</strong></li>`;
  itensEl.innerHTML = html;
}

document.getElementById("enviarWhats").addEventListener("click", ()=>{
  const endereco = document.getElementById("endereco").value.trim();
  const localEntrega = document.getElementById("localEntrega").value;
  const taxa = parseFloat(document.getElementById("localEntrega").selectedOptions[0]?.dataset.taxa || 0);
  const pagamento = document.getElementById("pagamento").value;

  if(!endereco) return alert("Informe o endereço.");
  if(!localEntrega) return alert("Escolha o local de entrega.");
  if(pedidos.length===0) return alert("Nenhum pedido adicionado.");

  let totalGeral = taxa;
  let msg = `🍽️ *Pedidos do Dia*\n📍 Local: ${localEntrega}\n🏠 Endereço: ${endereco}\n💳 Pagamento: ${pagamento}\n🏍️ Taxa: R$${taxa.toFixed(2)}\n`;

  pedidos.forEach((p,i)=>{
    totalGeral += p.valorMarmita||0;
    msg += `\n📌 Pedido ${i+1} - ${p.nome||"Cliente"}\n🍱 Marmita ${p.marmita} - R$${p.valorMarmita.toFixed(2)}\n`;
    if(p.carnes.length) p.carnes.forEach(c=>msg+=`🍖 ${c}\n`);
    if(p.acompanhamentos.length) p.acompanhamentos.forEach(a=>msg+=`🥗 ${a}\n`);
    if(p.refrigerantes.length) p.refrigerantes.forEach(r=>msg+=`🥤 ${r}\n`);
    if(p.adicionais) msg += `📝 ${p.adicionais}\n`;
  });
  msg += `\n💸 *TOTAL GERAL: R$${totalGeral.toFixed(2)}*`;

  window.open(`https://wa.me/556192633504?text=${encodeURIComponent(msg)}`,"_blank");

  // PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:'portrait', unit:'pt', format:[226,1000]});
  const data = new Date();
  const dia = String(data.getDate()).padStart(2,'0');
  const mes = String(data.getMonth()+1).padStart(2,'0');
  const ano = data.getFullYear();

  doc.setFont('helvetica','bold');
  doc.setFontSize(14);
  doc.text('Restaurante Colinas',113,20,{align:'center'});
  doc.setFont('helvetica','normal');
  doc.setFontSize(10);
  doc.text(`Pedidos de ${dia}/${mes}/${ano}`,113,35,{align:'center'});

  let y=55;
  doc.text(`Local: ${localEntrega}`,10,y); y+=12;
  doc.text(`Endereço: ${endereco}`,10,y); y+=12;
  doc.text(`Pagamento: ${pagamento}`,10,y); y+=12;
  doc.text(`Taxa de Entrega: R$${taxa.toFixed(2)}`,10,y); y+=20;

  pedidos.forEach((p,i)=>{
    doc.setFont('helvetica','bold'); 
    doc.text(`PEDIDO ${i+1} - ${p.nome||"Cliente"}`,10,y); y+=12;
    doc.setFont('helvetica','normal'); 
    doc.text(`Marmita ${p.marmita} - R$${p.valorMarmita.toFixed(2)}`,15,y); y+=12;
    if(p.carnes.length) p.carnes.forEach(c=>{ doc.text(`Carne: ${c}`,15,y); y+=12; });
    if(p.acompanhamentos.length) p.acompanhamentos.forEach(a=>{ doc.text(`Acomp.: ${a}`,15,y); y+=12; });
    if(p.refrigerantes.length) p.refrigerantes.forEach(r=>{ doc.text(`Bebida: ${r}`,15,y); y+=12; });
    if(p.adicionais){ doc.text(`Obs: ${p.adicionais}`,15,y); y+=12; }
    y+=8;
  });

  doc.text(`TOTAL GERAL: R$${totalGeral.toFixed(2)}`,10,y+10);
  doc.save(`Pedidos_${dia}-${mes}-${ano}.pdf`);
});
</script>

</body>
</html>
